# LinkSauce APIå¼€æ”¾å¹³å°å¼€å‘æ–‡æ¡£

## ä¸€ã€é¡¹ç›®è„šæ‰‹æ¶æ­å»º

### 1ã€Ant Design Pro

> æŸ¥çœ‹ [å®˜æ–¹æ–‡æ¡£](pro.ant.design/zh-CN/docs/getting-started)

1. å®‰è£…åˆå§‹åŒ–è„šæ‰‹æ¶

   ```shell
   # ä½¿ç”¨ npm
   npm i @ant-design/pro-cli -g
   ```

2. æ‰“å¼€å°†è¦å­˜æ”¾é¡¹ç›®çš„æ–‡ä»¶å¤¹ åˆ›å»ºé¡¹ç›®

   ```shell
   pro create linksauce-frontend
   ```

   **é€‰æ‹©umiç‰ˆæœ¬**

   >   ```shell
   >   ? ğŸ‚ ä½¿ç”¨ umi@4 è¿˜æ˜¯ umi@3 ? (Use arrow keys)
   >   â¯ umi@4
   >    umi@3
   >   ```

3. å®‰è£…yarn

   ```shell
   # å…¨å±€å®‰è£…
   npm install -g yarn
   ```

   æŸ¥çœ‹yarnç‰ˆæœ¬

   ```shell
   yarn -version
   ```

4. å®‰è£…ä¾èµ–

   ```shell
   yarn
   ```

5. è¿è¡Œæµ‹è¯•`package.json`ä¸­çš„`start`

   ![image-20240329154642753](å¼€å‘æ–‡æ¡£.assets/image-20240329154642753.png)

   ![image-20240329154745288](å¼€å‘æ–‡æ¡£.assets/image-20240329154745288.png)

6. é¡¹ç›®ç˜¦èº«ï¼Œ**æœ‰å‘ï¼Œå¯è·³è¿‡ï¼ï¼ï¼**

   - è¿è¡Œ`package.json`ä¸­çš„`i18n-remove`å»é™¤å›½é™…åŒ–ï¼Œæ‰‹åŠ¨åˆ é™¤`src\locales`

     > å¦‚æœæŠ¥é”™ï¼Œæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æ²¡åˆ å¹²å‡€ï¼Œå¯ä»¥æ‰‹åŠ¨å»é™¤

     **AntDesignå»å›½é™…åŒ– å routeré¡µé¢æ˜¾ç¤ºé—®é¢˜ï¼š**

     >   è§£å†³æ–¹æ³•ï¼šæ‰§è¡Œ 
     >
     >   yarn add eslint-config-prettier
     >
     >   yarn add eslint-plugin-unicorn
     >
     >   ç„¶åä¿®æ”¹node_modules/@umijs/lint/dist/config/eslint/index.js 
     >
     >   // es2022: trueæŠŠè¿™ä¸ªæ³¨é‡Šæ‰å°±å¯ä»¥è§£å†³é—®é¢˜

     å¦‚æœä¸è¡Œï¼Œä¿®æ”¹`config\routes.ts`å¦‚ä¸‹å³å¯ï¼š

     ```ts
     export default [
       { name: 'ç™»å½•', path: '/user', layout: false, routes: [{ path: '/user/login', component: './User/Login' }] },
       { name: 'æ¬¢è¿é¡µé¢', path: '/welcome', icon: 'smile', component: './Welcome' },
       {
         path: '/admin',
         icon: 'crown',
         access: 'canAdmin',
         name: 'ç®¡ç†å‘˜é¡µé¢',
         routes: [
           { path: '/admin', redirect: '/admin/sub-page' },
           { path: '/admin/sub-page', component: './Admin' },
         ],
       },
       { icon: 'table', path: '/list', component: './TableList', name: 'è¡¨æ ¼é¡µ' },
       { path: '/', redirect: '/welcome' },
       { path: '*', layout: false, component: './404' },
     ];
     ```

   - åˆ é™¤`src\tests`

7. é‡æ–°å®‰è£…ä¾èµ–ï¼Œé‡å¤ç¬¬äº”æ­¥ï¼Œç¡®è®¤æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œ

   ```shell
   yarn
   ```



### 2ã€åç«¯

#### 2.1. åˆå§‹åŒ–

> å‚è€ƒä½¿ç”¨[springboot-initæ¨¡æ¿](https://github.com/zhOhh/sptingboot-init)

#### 2.2. æ•°æ®åº“è¡¨è®¾è®¡

**åŸºæœ¬ç»“æ„**

| å­—æ®µå         | å¤‡æ³¨                         |
| -------------- | ---------------------------- |
| id             | ç”¨æˆ·id                       |
| name           | åç§°                         |
| description    | æè¿°                         |
| url            | æ¥å£åœ°å€                     |
| request_header | è¯·æ±‚å¤´                       |
| reponse_header | å“åº”å¤´                       |
| status         | æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ 1-å¼€å¯ï¼‰    |
| method         | è¯·æ±‚ç±»å‹                     |
| user_id        | åˆ›å»ºäºº                       |
| create_time    | åˆ›å»ºæ—¶é—´                     |
| update_time    | æ›´æ–°æ—¶é—´                     |
| is_delete      | é€»è¾‘åˆ é™¤ ï¼ˆ0-æœªåˆ  ï¼Œ1-å·²åˆ ï¼‰ |

**ä»£ç **

> å¯ä»¥ç”¨é±¼çš®å†™çš„sqlç”Ÿæˆå·¥å…·ç”Ÿæˆä¸€ä¸‹ä»£ç    [SQLä¹‹çˆ¶](https://www.sqlfather.com/)

å¡«å¯¹åº”çš„æ•°æ®ï¼Œä¸€é”®ç”Ÿæˆå³å¯

```sql
use linksauce;

-- æ¥å£ä¿¡æ¯
create table if not exists linksauce.`interface_info`
(
    `id` bigint not null auto_increment comment 'ä¸»é”®' primary key,
    `name` varchar(256) not null comment 'åç§°',
    `description` varchar(256) null comment 'æè¿°',
    `url` varchar(512) not null comment 'æ¥å£åœ°å€',
    `requestHeader` text null comment 'è¯·æ±‚å¤´',
    `responseHeader` text null comment 'å“åº”å¤´',
    `status` int default 0 not null comment 'æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ï¼Œ1-å¼€å¯ï¼‰',
    `method` varchar(256) not null comment 'è¯·æ±‚ç±»å‹',
    `userId` bigint not null comment 'åˆ›å»ºäºº',
    `createTime` datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    `updateTime` datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    `isDelete` tinyint default 0 not null comment 'æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )'
) comment 'æ¥å£ä¿¡æ¯';

insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å»–ç«‹è½©', 'è„±é¢–è€Œå‡º', 'www.foster-larkin.co', 'é¾™å˜‰æ‡¿', 'ç§¦å¤©ç£Š', 0, 'GET', 1718083101);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ›¹æ˜è¾‰', 'ä¸¾ä¸€åä¸‰', 'www.tony-kiehn.com', 'ä»»æ“è‹', 'é™ˆå‡¯ç‘', 0, 'GET', 28978);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('é‡‘ä¹é©¹', 'é¦–å½“å…¶å†²', 'www.coleen-prosacco.net', 'æ¯›æµ©', 'é™†è‡´è¿œ', 0, 'GET', 208);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å»–æ€', 'æ¥ä¹‹ä¸æ˜“', 'www.don-sipes.net', 'æ¢å½¬', 'ç™½å›æµ©', 0, 'GET', 470);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('è‘£ç…œç¥º', 'é•¿æ²»ä¹…å®‰', 'www.terry-turner.co', 'è¦ƒç»é½', 'èƒ¡é›ªæ¾', 0, 'GET', 611007);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('ä¾¯èªå¥', 'ç²¾å¿ƒè®¾è®¡', 'www.augustus-yost.info', 'å‚…é¸¿ç…Š', 'æ½˜é¹é£', 0, 'GET', 0);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('é­å¼˜æ–‡', 'ç©å¿½èŒå®ˆ', 'www.guadalupe-beatty.biz', 'æ±Ÿæ¢“æ™¨', 'é­æ€æ·¼', 0, 'GET', 1162536022);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('äºè‹‘åš', 'å„å¼å„æ ·', 'www.nolan-metz.net', 'éŸ¦æœ', 'é‡‘èƒ¤ç¥¥', 0, 'GET', 0);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å§šç‚«æ˜', 'ç¿»å¤©è¦†åœ°', 'www.jodie-schultz.info', 'è®¸è¶Šå½¬', 'æ¯›æ™‹é¹', 0, 'GET', 973);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å­™é‘«é¹', 'ç»œç»ä¸ç»', 'www.liza-sporer.co', 'å­™å½¬', 'å‚…é¸¿ç…Š', 0, 'GET', 30308);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å”å±•é¹', 'é“¤è€Œèµ°é™©', 'www.hayden-purdy.co', 'æ¨å“²ç€š', 'é™†å‡¯ç‘', 0, 'GET', 473462835);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ›¹æ“è‹', 'èµä¸ç»å£', 'www.phung-glover.org', 'é‚±å¿—æ³½', 'å¼ å¥é›„', 0, 'GET', 32155653);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å¤çƒ¨éœ–', 'å“­ç¬‘ä¸å¾—', 'www.augustine-funk.org', 'å®‹èªå¥', 'éƒé¹æ¶›', 0, 'GET', 3964);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('è‘£æµ©', 'å¯¹ç—‡ä¸‹è¯', 'www.erik-hamill.biz', 'é»ç«‹æœ', 'å»–é¹¤è½©', 0, 'GET', 2275);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('ç½—è£è½©', 'å–œé—»ä¹è§', 'www.gia-hermann.biz', 'éŸ©ç…œåŸ', 'é˜è€€æ°', 0, 'GET', 847);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ²ˆæ­£è±ª', 'ç»Ÿç­¹å…¼é¡¾', 'www.isabella-reinger.io', 'é‚“å­è½©', 'å»–ä¼Ÿè¯š', 0, 'GET', 997378602);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('ä»»ç«‹æœ', 'å‡ºäººæ„æ–™', 'www.geoffrey-koss.name', 'è¦ƒæµ©ç„¶', 'è§é›¨æ³½', 0, 'GET', 403);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å¼ ç‚«æ˜', 'åä¸è™šä¼ ', 'www.ellan-gleason.com', 'é»æ­£è±ª', 'éŸ¦ç‚å½¬', 0, 'GET', 35127293);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ–¹é›¨æ³½', 'è¡£é£Ÿä½è¡Œ', 'www.wilton-walsh.biz', 'é»è¶Šæ³½', 'ç™½è¿œèˆª', 0, 'GET', 62264);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('è¢å¤©ç¿Š', 'å·åœŸé‡æ¥', 'www.lynetta-mclaughlin.info', 'é‚¹ç† å½¤', 'å¶æ½‡ç„¶', 0, 'GET', 9884455);
```

#### 2.3. MabatisXæ’ä»¶

ç”Ÿæˆdomainã€mapperã€service

æ‰“å¼€æ–°å»ºçš„è¡¨ï¼Œå³å‡»é€‰æ‹©MybatisX-Generator

å‹¾ä¸Šé©¼å³°

![image-20240329175949857](å¼€å‘æ–‡æ¡£.assets/image-20240329175949857.png)

æ ¹æ®**ç‰ˆæœ¬å’Œéœ€è¦æ‰“å‹¾**ï¼Œç‚¹å‡»å®Œæˆ

![image-20240329180554301](å¼€å‘æ–‡æ¡£.assets/image-20240329180554301.png)

#### 2.4. Controller

> æˆ‘ä»¬åªéœ€è¦å°†**PostController**å¤åˆ¶ä¸€ä»½æ”¹åä¸º**InterfaceInfoController**å³å¯,å› ä¸ºé€»è¾‘æ˜¯å·®ä¸å¤šï¼Œéƒ½æ˜¯è¿›è¡Œå¢åˆ æ”¹æŸ¥

ç„¶åå°†postæ”¹æˆinterfaceInfoã€Postæ”¹æˆInterfaceInfo

æ ¹æ®æŠ¥é”™ä¿¡æ¯æˆ‘ä»¬æ¥è¡¥å……ä¿¡æ¯



#### 2.5. Model

##### (1) Entity

```java
package com.ohh.project.model.entity;

import com.baomidou.mybatisplus.annotation.*;

import java.io.Serializable;
import java.util.Date;
import lombok.Data;

/**
 * æ¥å£ä¿¡æ¯
 * @TableName interface_info
 */
@TableName(value ="interface_info")
@Data
public class InterfaceInfo implements Serializable {
    /**
     * ä¸»é”®
     */
    @TableId(type = IdType.AUTO)
    private Long id;

    /**
     * åç§°
     */
    private String name;

    /**
     * æè¿°
     */
    private String description;

    /**
     * æ¥å£åœ°å€
     */
    private String url;

    /**
     * è¯·æ±‚å¤´
     */
    private String requestHeader;

    /**
     * å“åº”å¤´
     */
    private String responseHeader;

    /**
     * æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ï¼Œ1-å¼€å¯ï¼‰
     */
    private Integer status;

    /**
     * è¯·æ±‚ç±»å‹
     */
    private String method;

    /**
     * åˆ›å»ºäºº
     */
    private Long userId;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    /**
     * æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )
     */
    @TableLogic
    private Integer isDelete;

    @TableField(exist = false)
    private static final long serialVersionUID = 1L;
}
```

##### (2) DTO

é¦–å…ˆå…ˆå¢åŠ DTOï¼Œåœ¨InterfaceInfoç±»ä»æ‹¿æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯åšæˆä¸‰ä¸ªDTOç±»ï¼ˆåˆ†åˆ«æ˜¯æ–°å¢ã€æŸ¥è¯¢ã€æ›´æ–°ï¼‰åˆ é™¤çš„è¯·æ±‚æˆ‘ä»¬å°è£…åœ¨commonåŒ…ä¸‹

![image-20230112184904561](å¼€å‘æ–‡æ¡£.assets/image-20230112184904561.png)



#### 2.6. Service

æ ¹æ®æŠ¥é”™å¯çŸ¥ serviceå±‚ç¼ºå°‘ä¸€ä¸ªæ–¹æ³•validInterfaceInfo

```java
package com.ohh.project.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.ohh.project.common.ErrorCode;
import com.ohh.project.exception.BusinessException;
import com.ohh.project.mapper.InterfaceInfoMapper;
import com.ohh.project.model.entity.InterfaceInfo;
import com.ohh.project.service.InterfaceInfoService;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Service;

/**
* @author 12994
* @description é’ˆå¯¹è¡¨ã€interface_info(æ¥å£ä¿¡æ¯)ã€‘çš„æ•°æ®åº“æ“ä½œServiceå®ç°
* @createDate 2024-03-29 18:05:35
*/
@Service
public class InterfaceInfoServiceImpl extends ServiceImpl<InterfaceInfoMapper, InterfaceInfo>
    implements InterfaceInfoService {

    @Override
    public void validInterfaceInfo(InterfaceInfo interfaceInfo, boolean add) {
        if (interfaceInfo == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }

        String name = interfaceInfo.getName();
        String description = interfaceInfo.getDescription();
        String url = interfaceInfo.getUrl();
        String requestHeader = interfaceInfo.getRequestHeader();
        String responseHeader = interfaceInfo.getResponseHeader();
        Integer status = interfaceInfo.getStatus();
        String method = interfaceInfo.getMethod();
        Long userId = interfaceInfo.getUserId();

        // åˆ›å»ºæ—¶ï¼Œæ‰€æœ‰å‚æ•°å¿…é¡»éç©º
        if (add) {
            if (StringUtils.isAnyBlank(name, description, url, requestHeader, responseHeader, method) || ObjectUtils.anyNull(userId, status)) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR);
            }
        }
        if (StringUtils.isNotBlank(name) && name.length() > 256) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "åå­—è¿‡é•¿");
        }
        if (StringUtils.isNotBlank(description) && description.length() > 512) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "æè¿°è¿‡é•¿");
        }
    }

}

```

### 3ã€å‰ç«¯

#### 3.1. é…ç½®æ’ä»¶

ä¸ºäº†é¡¹ç›®æ›´åŠ è§„èŒƒ

> æœç´¢ **eslint** é€‰ä¸Šè‡ªåŠ¨è¯†åˆ«

![image-20230112193957977](å¼€å‘æ–‡æ¡£.assets/image-20230112193957977.png)



> æœç´¢**prettier** æ‰“âˆš  ç¾åŒ–ä»£ç 

![image-20230112194107217](å¼€å‘æ–‡æ¡£.assets/image-20230112194107217.png)

#### 3.2. æ¥å£è°ƒç”¨

ä½¿ç”¨ **oneapi** æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ

å¦‚æœè¦å‰ç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œéœ€è¦å°†åç«¯çš„éµå¾ª**openapi**è§„èŒƒçš„**json**æ–‡æ¡£ 

> åç«¯çš„éµå¾ª**openapi**è§„èŒƒçš„**json**æ–‡æ¡£ 

æ‰¾åˆ°æˆ‘ä»¬èµ·çš„åç«¯ä¸»é¡µ

æ‰¾åˆ°æˆ‘ä»¬èµ·çš„åç«¯ä¸»é¡µ

![image-20230112195321863](å¼€å‘æ–‡æ¡£.assets/image-20230112195321863-17118630680604.png)

åœ¨åœ°å€æ è¾“å…¥http://localhost:7529/api/v3/api-docs

å‘ç°å¦‚ä¸‹æ‰€ç¤º

![image-20240331133328390](å¼€å‘æ–‡æ¡£.assets/image-20240331133328390.png)

é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªurläº†

**ä¿®æ”¹ï¼š**`config\config.ts` ï¼Œæ‰¾åˆ°**openApi** ä¿®æ”¹å¦‚ä¸‹

```tsx
openAPI: [
    {
      requestLibPath: "import { request } from '@umijs/max'",
      schemaPath: 'http://localhost:7529/api/v3/api-docs',
      projectName: 'linksauce-backend',
    },
  ],
```

æµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½ç”¨

> æ‰¾åˆ°**package.json**,æ‰§è¡Œ**openapi**å‘½ä»¤
>
> ![image-20240331133404196](å¼€å‘æ–‡æ¡£.assets/image-20240331133404196.png)

æ‰§è¡ŒæˆåŠŸï¼ŒæŸ¥çœ‹**service**æ–‡ä»¶å¤¹

![image-20240331133533073](å¼€å‘æ–‡æ¡£.assets/image-20240331133533073.png)

ç”±äºæˆ‘ä»¬æœ‰åç«¯ ï¼Œåº”è¯·æ±‚çœŸå®ç¯å¢ƒï¼Œæ‰€ä»¥ç›´æ¥ç”¨**devæ¨¡å¼**è¿è¡Œ

```bash
npm run start:dev
```

å¯ä»¥å°†é¡¹ç›®ä¸­çš„`requestErrorConfig.ts`æ”¹ä¸º`requestConfig.ts`

ç„¶ååœ¨`app.tsx` æ‰¾åˆ° requesté…ç½®ï¼Œå°†å…¶ä¿®æ”¹æˆæˆ‘ä»¬æ”¹çš„

```java
export const request = {
  ...requestConfig,
};
```

**æ‰¾åˆ°`requestConfig.ts`**

ä¿®æ”¹åå­—ï¼Œå¹¶è®¾ç½®ä¸€ä¸‹åç«¯åœ°å€

**è®¾ç½®cookie!!!**

![image-20240331133754108](å¼€å‘æ–‡æ¡£.assets/image-20240331133754108.png)

> ```java
> baseURL: 'http://localhost:7529',
> withCredentials: true,
> ```

#### 3.3. ä¿®æ”¹ç™»å½•æ¥å£

æ‰¾åˆ°`src/pages/User/Login/index.tsx`ä¸‹çš„**handleSubmit**

ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç çš„å­—æ®µå’Œåç«¯ä¿æŒä¸€è‡´

**è®¾ç½®ç”¨æˆ·ç™»å½•æ€**

å›åˆ°`app.tsx`æ‰¾åˆ°**getInitialState()**è¿™ä¸ªæ–¹æ³•

è¿™ä¸ªæ–¹æ³•å½“é¦–æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œè·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè·å–å½“å‰å…¨å±€çš„ä¸€äº›çŠ¶æ€ï¼Œå¯ä»¥æŠŠå®ƒå½“æˆå…¨å±€å˜é‡

æ‰¾åˆ°`typings.d.ts`

```ts
/**
 * å…¨å±€çŠ¶æ€ç±»å‹
 */
interface InitialState{
  loginUser?:API.UserVO;
}
```

è¿”å›**getInitialState()**å°†å®ƒæ”¹ä¸º

```tsx
export async function getInitialState(): Promise<InitialState> {
  // å½“é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè·å–è¦å…¨å±€ä¿å­˜çš„æ•°æ®ï¼Œå¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯
  const state: InitialState = {
    loginUser: undefined,
  };
  try {
    const res = await getLoginUserUsingGet();
    if (res.data) {
      state.loginUser = res.data;
    }
  } catch (error) {
    history.push(loginPath);
  }
  return state;
}
```



è¿”å›`src/pages/User/Login/index.tsx`ä¸‹çš„**handleSubmit**

è®¾ç½®ç™»å½•çŠ¶æ€

```tsx
  const handleSubmit = async (values: API.UserLoginRequest) => {
    try {
      // ç™»å½•
      const res = await userLoginUsingPOST({ ...values });
      if (res.data) {
        const urlParams = new URL(window.location.href).searchParams;
        history.push(urlParams.get('redirect') || '/');
        setInitialState({
          loginUser: res.data
        });
        return;
      }
    } catch (error) {
      const defaultLoginFailureMessage = intl.formatMessage({
        id: 'pages.login.failure',
        defaultMessage: 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼',
      });
      console.log(error);
      message.error(defaultLoginFailureMessage);
    }
  };
```

#### 3.4. æ³¨é”€

æ‰¾åˆ°`src/components/RightContent/AvatarDropdown.tsx`çš„**loginout()**å°†å…¶æ”¹ä¸ºè‡ªå·±çš„åç«¯æ–¹æ³•

```java
const onMenuClick = useCallback(
  (event: MenuInfo) => {
    const { key } = event;
    if (key === 'logout') {
      flushSync(() => {
        setInitialState((s) => ({ ...s, currentUser: undefined }));
      });
      userLogoutUsingPost();
      return;
    }
    history.push(`/account/${key}`);
  },
  [setInitialState],
);
```

#### 3.5. è®¾ç½®ç®¡ç†æƒé™ 

ä¿®æ”¹`access.ts`

```ts
/**
 * @see https://umijs.org/docs/max/access#access
 * */
export default function access(initialState: InitialState | undefined) {
  const { loginUser } = initialState ?? {};
  return {
    // canAdmin: currentUser && currentUser.access === 'admin',
    canUser: loginUser,
    canAdmin: loginUser?.userRole === 'admin',
  };
}
 
```

#### 3.6. ä¿®æ”¹è¡¨æ ¼å†…å®¹

æ‰¾åˆ°`src/pages/TableList/index.tsx`çš„**columns**ï¼Œä¿®æ”¹å¦‚ä¸‹

```tsx
const columns: ProColumns<API.InterfaceInfo>[] = [
  {
    title: 'id',
    dataIndex: 'id',
    valueType: 'index',
  },
  {
    title: 'æ¥å£åç§°',
    dataIndex: 'name',
    valueType: 'text',
  },
  {
    title: 'æè¿°',
    dataIndex: 'description',
    valueType: 'textarea',
  },
  {
    title: 'è¯·æ±‚æ–¹æ³•',
    dataIndex: 'method',
    valueType: 'textarea',
  },
  {
    title: 'url',
    dataIndex: 'url',
    valueType: 'text',
  },
  {
    title: 'è¯·æ±‚å¤´',
    dataIndex: 'requestHeader',
    valueType: 'textarea',
  },
  {
    title: 'å“åº”å¤´',
    dataIndex: 'responseHeader',
    valueType: 'textarea',
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    hideInForm: true,
    valueEnum: {
      0: {
        text: 'å…³é—­',
        status: 'Default',
      },
      1: {
        text: 'è¿è¡Œä¸­',
        status: 'Processing',
      },
    },
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createTime',
    valueType: 'dateTime',
  },
  {
    title: 'æ›´æ–°æ—¶é—´',
    dataIndex: 'updateTime',
    valueType: 'dateTime',
  },
  {
    title: 'æ“ä½œ',
    dataIndex: 'option',
    valueType: 'option',
    render: (_, record) => [
      <a
        key="config"
        onClick={() => {
          handleUpdateModalOpen(true);
          setCurrentRow(record);
        }}
      >
        é…ç½®
      </a>,
      <a key="subscribeAlert" href="https://procomponents.ant.design/">
        è®¢é˜…è­¦æŠ¥
      </a>,
    ],
  },
];
```

ä¿®æ”¹`request`å¦‚ä¸‹ï¼š

```tsx
request={async (
  params: {
    pageSize?: number;
    current?: number;
    keyword?: string;
  }, sort: Record<string, SortOrder>,  filter: Record<string, React.ReactText[] | null>,) => {
  const res = await listInterfaceInfoByPageUsingGet({ ...params });
  if (res.data) {
    return {
      data: res.data.records || [],
      success: true,
      total: res.data.total,
    };
  } else {
    return {
      data: [],
      success: false,
      total: 0,
    };
  }
}}
```

**åˆ·æ–°é¡µé¢ï¼Œæ˜¾ç¤ºæˆåŠŸ**

![image-20240331135817432](å¼€å‘æ–‡æ¡£.assets/image-20240331135817432.png)



## äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥

### 1ã€ä¿®æ”¹è·¯ç”±

æ‰“å¼€**config**åŒ…æ‰¾åˆ° **routes.ts**

å°†åŸæ¥pagesä¸‹çš„**TableList**è¡¨å•åç§°æ”¹ä¸ºæˆ‘ä»¬çš„**interfaceInfo**ï¼Œå†æŠŠæ¥å£ç®¡ç†é¡µé¢é…ç½®åˆ°ç®¡ç†å‘˜é¡µé¢ä¸‹

```js
{
  name: 'æ¥å£ç®¡ç†',
  icon: 'table',
  path: '/admin/interface_info',
  component: './InterfaceInfo',
}
```



```typescript
export default [
  {
    path: '/user',
    layout: false,
    routes: [
      {
        name: 'login',
        path: '/user/login',
        component: './User/Login',
      },
    ],
  },
  {
    path: '/welcome',
    name: 'welcome',
    icon: 'smile',
    component: './Welcome',
  },
  {
    path: '/admin',
    name: 'admin',
    icon: 'crown',
    access: 'canAdmin',
    routes: [
      {
        path: '/admin',
        redirect: '/admin/sub-page',
      },
      {
        path: '/admin/sub-page',
        name: 'sub-page',
        component: './Admin',
      },
      {
        name: 'æ¥å£ç®¡ç†',
        icon: 'table',
        path: '/admin/interface_info',
        component: './InterfaceInfo',
      },
    ],
  },
  {
    path: '/',
    redirect: '/welcome',
  },
  {
    path: '*',
    layout: false,
    component: './404',
  },
];

```

æ•ˆæœå¦‚ä¸‹



### 2ã€æ–°å¢æ¥å£ä¿¡æ¯

---

#### 2.1. è¡¨å•æ¨¡å—

**interfaceInfo**ä¸­çš„**index.tsx**æ‰¾åˆ°æ–°å»ºçš„Button

![image-20230113153334776](å¼€å‘æ–‡æ¡£.assets/image-20230113153334776.png)

æˆ‘ä»¬ç‚¹å‡»æ–°å»ºçš„æ—¶å€™ï¼Œä»–ä¼šæ‰“å¼€ä¸€ä¸ªæ¨¡æ€æ¡†ã€‚å¾€ä¸‹æ‰¾ï¼Œå‘ç°å®ƒå·²ç»ç»™æˆ‘ä»¬æä¾›äº†è¿™ä¸ªç»„ä»¶ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦é‡æ–°å†™

![image-20230113153512970](å¼€å‘æ–‡æ¡£.assets/image-20230113153512970.png)

æˆ‘ä»¬å¯ä»¥å°±åƒæ›´æ–°æ¨¡æ€æ¡†ä¸€æ ·æ–°å»ºä¸€ä¸ªCreateModal.tsx

![image-20230113153639726](å¼€å‘æ–‡æ¡£.assets/image-20230113153639726.png)

æ¥ä¸‹æ¥ä¿®æ”¹ä»UpdateFormä¸­ç²˜è´´çš„**CreateModal.tsx**çš„ä»£ç 

```tsx
import { Modal } from 'antd';
import React from 'react';
import { ProColumns, ProTable } from '@ant-design/pro-components';
import '@umijs/max';

export type Props = {
  columns: ProColumns<API.InterfaceInfo>[];
  onCancel: () => void;
  onSubmit: (values: API.InterfaceInfo) => Promise<boolean>;
  open: boolean;
};

const CreateModal: React.FC<Props> = (props) => {
  const { columns, open, onCancel } = props;
  return (
    <Modal open={open} onCancel={() => onCancel?.()}>
      <ProTable columns={columns} />
    </Modal>
  );
};

export default CreateModal;
```

**è¿™é‡Œæˆ‘ä»¬å¤ç”¨äº†indexä¸­çš„columns**  è¿™é‡Œæˆ‘é¡ºä¾¿æŠŠå–æ¶ˆä¹Ÿå†™äº†

åœ¨**index.tsx**ä¸­ä½¿ç”¨

```tsx
  /**
   * @en-US Pop-up window of new window
   * @zh-CN æ–°å»ºçª—å£çš„å¼¹çª—
   *  */
  const [createModalOpen, handleModalOpen] = useState<boolean>(false);
	
 	const columns: ProColumns<API.InterfaceInfo>[] = [
    {
      title: 'id',
      dataIndex: 'id',
      valueType: 'index',
    },
   // ...
  ]

	// ...
	<CreateModal
    columns={columns}
    onCancel={() => handleModalOpen(false)}
    onSubmit={() => {}}
    open={createModalOpen}
  />
```

æµ‹è¯•ä¸€ä¸‹

![image-20230113164234500](å¼€å‘æ–‡æ¡£.assets/image-20230113164234500.png)

emmmm... è¿™æ˜¯ä»€ä¹ˆç©æ„??

æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œè¿™æ˜¯ProTableçš„é»˜è®¤type æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™å®ƒæŒ‡å®šä¸€ä¸ªformçš„type

```tsx
const CreateModal: React.FC<Props> = (props) => {
  const { columns, open, onCancel } = props;
  return (
    <Modal open={open} onCancel={() => onCancel?.()}>
      <ProTable columns={columns} type={'form'} />
    </Modal>
  );
};
```

å†æµ‹è¯•ä¸€ä¸‹å°±æ­£å¸¸å•¦~

![image-20230113164846052](å¼€å‘æ–‡æ¡£.assets/image-20230113164846052.png)

å‘ç°åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´æˆ‘ä»¬å¹¶ä¸éœ€è¦ã€‚å¢åŠ hideInFormå±æ€§

```tsx
    {
      title: 'åˆ›å»ºæ—¶é—´',
      dataIndex: 'createTime',
      valueType: 'dateTime',
      hideInForm: true,
    },
    {
      title: 'æ›´æ–°æ—¶é—´',
      dataIndex: 'updateTime',
      valueType: 'dateTime',
      hideInForm: true,
    },
```



#### 2.2. è¯·æ±‚åç«¯

**å…ˆç®€å•å¤„ç†ä¸€ä¸‹è¯·æ±‚æŠ¥é”™çš„æƒ…å†µ**

æ‰¾åˆ°`src/requestConfig.ts` ä¿®æ”¹ä¸€ä¸‹å“åº”æ‹¦æˆªå™¨

```typescript
  // å“åº”æ‹¦æˆªå™¨
  responseInterceptors: [
    (response) => {
      // æ‹¦æˆªå“åº”æ•°æ®ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å¤„ç†
      const { data } = response as unknown as ResponseStructure;
      console.log('data', data);
      if (data.code !== 0) {
        throw new Error(data.message);
      }
      return response;
    },
  ],
```

å†åœ¨`interfaceinfo/index.tsxä¸­`æ–°å¢è¯·æ±‚åç«¯çš„æ–¹æ³•

```tsx
  const handleAddInterfaceInfo = async (fields: API.InterfaceInfoAddRequest) => {
    const hide = message.loading('æ­£åœ¨æ·»åŠ ');
    try {
      await addInterfaceInfoUsingPOST({ ...fields });
      hide();
      message.success('åˆ›å»ºæˆåŠŸ!');
      // å…³é—­Modal
      handleModalOpen(false);
      return true;
    } catch (error: any) {
      hide();
      console.log(error);
      message.error('åˆ›å»ºå¤±è´¥!' + error.message);
      return false;
    }
  };

// ...

<CreateModal
  columns={columns}
  onCancel={() => handleModalOpen(false)}
  onSubmit={(values) => handleAddInterfaceInfo(values)}
  open={createModalOpen}
  />
```

å†ä¿®æ”¹`CreateModal.tsx`

```tsx
const CreateModal: React.FC<Props> = (props) => {
  const { columns, open, onCancel, onSubmit } = props;
  return (
    <Modal title={'æ–°å»ºæ¥å£'} open={open} onCancel={() => onCancel?.()}>
      <ProTable columns={columns} type={'form'} onSubmit={async (value) => onSubmit?.(value)} />
    </Modal>
  );
};
```



æµ‹è¯•æ·»åŠ æˆåŠŸ

![image-20230113183349785](å¼€å‘æ–‡æ¡£.assets/image-20230113183349785.png)





### 3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯

---

å…ˆæŠŠModalçš„footerå¹²æ‰   footer={null}

```ts
<Modal title={'æ›´æ–°æ¥å£'} footer={null} open={open} onCancel={() => onCancel?.()}>
		  // ...
  );
```



#### 3.1. è¡¨å•æ¨¡å—

æ–°å»ºæ–‡ä»¶`src/pages/InterfaceInfo/components/UpdateModal.tsx`

è¿™é‡Œä½¿ç”¨çš„useRefã€formRefå‚è€ƒäº†[å®˜æ–¹æ–‡æ¡£](https://procomponents.ant.design/components/table#%E9%80%9A%E8%BF%87-formref-%E6%9D%A5%E6%93%8D%E4%BD%9C%E6%9F%A5%E8%AF%A2%E8%A1%A8%E5%8D%95)

```tsx
import { Modal } from 'antd';
import React, {useEffect, useRef} from 'react';
import { ProColumns, ProFormInstance, ProTable } from '@ant-design/pro-components';
import '@umijs/max';

export type Props = {
  value: API.InterfaceInfo;
  columns: ProColumns<API.InterfaceInfoUpdateRequest>[];
  onCancel: () => void;
  onSubmit: (values: API.InterfaceInfoUpdateRequest) => Promise<void>;
  open: boolean;
};

const UpdateModal: React.FC<Props> = (props) => {
  const { value, columns, open, onCancel, onSubmit } = props;

  const formRef = useRef<ProFormInstance>();

  useEffect(() => {
    if (formRef) {
      formRef.current?.setFieldsValue(value);
    }
  }, [value]);

  return (
    <Modal title={'æ›´æ–°æ¥å£'} footer={null} open={open} onCancel={() => onCancel?.()}>
      <ProTable
        columns={columns}
        formRef={formRef}
        type={'form'}
        onSubmit={async (value) => onSubmit?.(value)}
        // è®¾ç½®é»˜è®¤å€¼
        form={{ initialValues: value }}
      />
    </Modal>
  );
};

export default UpdateModal;

```



#### 3.2. è¯·æ±‚åç«¯

åœ¨`interfaceinfo/index.tsx`ä¸­æ–°å¢è¯·æ±‚åç«¯çš„æ–¹æ³•

```tsx
  /**
   * @en-US Update InterfaceInfo
   * @zh-CN æ›´æ–°æ¥å£ä¿¡æ¯
   *
   * @param updateValue
   */
  const handleUpdateInterfaceInfo = async (updateValue: API.InterfaceInfoUpdateRequest) => {
    const hide = message.loading('æ­£åœ¨æ›´æ–°');
    try {
      let res = await updateInterfaceInfoUsingPOST({ ...updateValue });
      if (res.data) {
        hide();
        handleUpdateModalOpen(false);
        message.success('æ›´æ–°æˆåŠŸ!');
        return true;
      }
    } catch (error: any) {
      hide();
      message.error('æ›´æ–°å¤±è´¥!' + error.message);
      return false;
    }
  };      



// è¿™é‡Œçš„<UpdateModal/>ä»£ç æ˜¯åœ¨åŸæœ‰çš„ <UpdateForm/> åŸºç¡€ä¸Šé¢æ”¹çš„
<UpdateModal
        value={currentRow || {}}
        columns={columns}
        open={updateModalOpen}
        onSubmit={async (value) => {
          const success = await handleUpdateInterfaceInfo(value);
          if (success) {
            handleUpdateModalOpen(false);
            setCurrentRow(undefined);
            if (actionRef.current) {
              actionRef.current.reload();
            }
          }
        }}
        onCancel={() => {
          handleUpdateModalOpen(false);
          if (!showDetail) {
            setCurrentRow(undefined);
          }
        }}
      />
```

å‡ºé”™äº†ï¼ŒçŒœæµ‹æ˜¯Ant Design Proçš„é—®é¢˜ï¼ŒçŒœé”™äº†ï¼Œå…¶å®æ˜¯columnsä¸­çš„idçš„typeä¸ºindexçš„åŸå› ã€‚å¹¶æ²¡æœ‰idå­—æ®µï¼Œæ‰€ä»¥æˆ‘æ‰‹åŠ¨ç»™ä¸€ä¸‹

![image-20230113222955554](å¼€å‘æ–‡æ¡£.assets/image-20230113222955554.png)

ä¿®æ”¹ä»£ç å¦‚ä¸‹

```tsx
/**
   * @en-US Update InterfaceInfo
   * @zh-CN æ›´æ–°æ¥å£ä¿¡æ¯
   *
   * @param fields
   */
  const handleUpdateInterfaceInfo = async (fields: API.InterfaceInfoUpdateRequest) => {
    const hide = message.loading('æ­£åœ¨æ›´æ–°');
    try {
      if(!currentRow){
        return false;
      }
      let res = await updateInterfaceInfoUsingPOST({
        // å› ä¸ºcolumnsä¸­çš„id valueTypeä¸ºindex ä¸ä¼šä¼ é€’ æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨èµ‹å€¼id
        id: currentRow.id,
        ...fields,
      });
      if (res.data) {
        hide();
        handleUpdateModalOpen(false);
        message.success('æ›´æ–°æˆåŠŸ!');
        // åˆ·æ–°é¡µé¢
        actionRef.current?.reload();
        return true;
      }
    } catch (error: any) {
      hide();
      message.error('æ›´æ–°å¤±è´¥!' + error.message);
      return false;
    }
  };

```

æµ‹è¯•æ›´æ–°æˆåŠŸ~





### 4ã€åˆ é™¤æ¥å£ä¿¡æ¯

---

**åˆ é™¤æŒ‰é’®**

```tsx
// åœ¨columnsä¸­æ·»åŠ åˆ é™¤æŒ‰é’®	
{
      title: 'æ“ä½œ',
      dataIndex: 'option',
      valueType: 'option',
      render: (_, record) => [
        <a
          key="config"
          onClick={() => {
            handleUpdateModalOpen(true);
            setCurrentRow(record);
          }}
        >
          ç¼–è¾‘
        </a>,
        <a
          key="delete"
          onClick={() => {
            handleRemoveInterfaceInfo(record);
          }}
        >
          åˆ é™¤
        </a>,
      ],
    },
```

**è°ƒç”¨æ–¹æ³•**

```tsx
  const handleRemoveInterfaceInfo = async (record: API.InterfaceInfo) => {
    const hide = message.loading('æ­£åœ¨åˆ é™¤');
    if (!record) return true;
    try {
      await deleteInterfaceInfoUsingPOST({
        id: record.id,
      });
      hide();
      message.success('åˆ é™¤æˆåŠŸ!');
      // åˆ·æ–°é¡µé¢
      actionRef.current?.reload();
      return true;
    } catch (error: any) {
      hide();
      message.error('åˆ é™¤å¤±è´¥!' + error.message);
      return false;
    }
  };
```



æµ‹è¯•åˆ é™¤æˆåŠŸ~

![image-20230114154218713](å¼€å‘æ–‡æ¡£.assets/image-20230114154218713.png)


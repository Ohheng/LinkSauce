# LinkSauce APIå¼€æ”¾å¹³å°å¼€å‘æ–‡æ¡£

## ä¸€ã€é¡¹ç›®è„šæ‰‹æ¶æ­å»º

### 1ã€Ant Design Pro

> æŸ¥çœ‹ [å®˜æ–¹æ–‡æ¡£](pro.ant.design/zh-CN/docs/getting-started)

1. å®‰è£…åˆå§‹åŒ–è„šæ‰‹æ¶

   ```shell
   # ä½¿ç”¨ npm
   npm i @ant-design/pro-cli -g
   ```

2. æ‰“å¼€å°†è¦å­˜æ”¾é¡¹ç›®çš„æ–‡ä»¶å¤¹ åˆ›å»ºé¡¹ç›®

   ```shell
   pro create linksauce-frontend
   ```

   **é€‰æ‹©umiç‰ˆæœ¬**

   >   ```shell
   >   ? ğŸ‚ ä½¿ç”¨ umi@4 è¿˜æ˜¯ umi@3 ? (Use arrow keys)
   >   â¯ umi@4
   >    umi@3
   >   ```

3. å®‰è£…yarn

   ```shell
   # å…¨å±€å®‰è£…
   npm install -g yarn
   ```

   æŸ¥çœ‹yarnç‰ˆæœ¬

   ```shell
   yarn -version
   ```

4. å®‰è£…ä¾èµ–

   ```shell
   yarn
   ```

5. è¿è¡Œæµ‹è¯•`package.json`ä¸­çš„`start`

   ![image-20240329154642753](å¼€å‘æ–‡æ¡£.assets/image-20240329154642753.png)

   ![image-20240329154745288](å¼€å‘æ–‡æ¡£.assets/image-20240329154745288.png)

6. é¡¹ç›®ç˜¦èº«ï¼Œ**æœ‰å‘ï¼Œå¯è·³è¿‡ï¼ï¼ï¼**

   - è¿è¡Œ`package.json`ä¸­çš„`i18n-remove`å»é™¤å›½é™…åŒ–ï¼Œæ‰‹åŠ¨åˆ é™¤`src\locales`

     > å¦‚æœæŠ¥é”™ï¼Œæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æ²¡åˆ å¹²å‡€ï¼Œå¯ä»¥æ‰‹åŠ¨å»é™¤

     **AntDesignå»å›½é™…åŒ– å routeré¡µé¢æ˜¾ç¤ºé—®é¢˜ï¼š**

     >   è§£å†³æ–¹æ³•ï¼šæ‰§è¡Œ 
     >
     >   yarn add eslint-config-prettier
     >
     >   yarn add eslint-plugin-unicorn
     >
     >   ç„¶åä¿®æ”¹node_modules/@umijs/lint/dist/config/eslint/index.js 
     >
     >   // es2022: trueæŠŠè¿™ä¸ªæ³¨é‡Šæ‰å°±å¯ä»¥è§£å†³é—®é¢˜

     å¦‚æœä¸è¡Œï¼Œä¿®æ”¹`config\routes.ts`å¦‚ä¸‹å³å¯ï¼š

     ```ts
     export default [
       { name: 'ç™»å½•', path: '/user', layout: false, routes: [{ path: '/user/login', component: './User/Login' }] },
       { name: 'æ¬¢è¿é¡µé¢', path: '/welcome', icon: 'smile', component: './Welcome' },
       {
         path: '/admin',
         icon: 'crown',
         access: 'canAdmin',
         name: 'ç®¡ç†å‘˜é¡µé¢',
         routes: [
           { path: '/admin', redirect: '/admin/sub-page' },
           { path: '/admin/sub-page', component: './Admin' },
         ],
       },
       { icon: 'table', path: '/list', component: './TableList', name: 'è¡¨æ ¼é¡µ' },
       { path: '/', redirect: '/welcome' },
       { path: '*', layout: false, component: './404' },
     ];
     ```

   - åˆ é™¤`src\tests`

7. é‡æ–°å®‰è£…ä¾èµ–ï¼Œé‡å¤ç¬¬äº”æ­¥ï¼Œç¡®è®¤æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œ

   ```shell
   yarn
   ```



### 2ã€åç«¯

#### 2.1. åˆå§‹åŒ–

> å‚è€ƒä½¿ç”¨[springboot-initæ¨¡æ¿](https://github.com/zhOhh/sptingboot-init)

#### 2.2. æ•°æ®åº“è¡¨è®¾è®¡

**åŸºæœ¬ç»“æ„**

| å­—æ®µå         | å¤‡æ³¨                         |
| -------------- | ---------------------------- |
| id             | ç”¨æˆ·id                       |
| name           | åç§°                         |
| description    | æè¿°                         |
| url            | æ¥å£åœ°å€                     |
| request_header | è¯·æ±‚å¤´                       |
| reponse_header | å“åº”å¤´                       |
| status         | æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ 1-å¼€å¯ï¼‰    |
| method         | è¯·æ±‚ç±»å‹                     |
| user_id        | åˆ›å»ºäºº                       |
| create_time    | åˆ›å»ºæ—¶é—´                     |
| update_time    | æ›´æ–°æ—¶é—´                     |
| is_delete      | é€»è¾‘åˆ é™¤ ï¼ˆ0-æœªåˆ  ï¼Œ1-å·²åˆ ï¼‰ |

**ä»£ç **

> å¯ä»¥ç”¨é±¼çš®å†™çš„sqlç”Ÿæˆå·¥å…·ç”Ÿæˆä¸€ä¸‹ä»£ç    [SQLä¹‹çˆ¶](https://www.sqlfather.com/)

å¡«å¯¹åº”çš„æ•°æ®ï¼Œä¸€é”®ç”Ÿæˆå³å¯

```sql
use linksauce;

-- æ¥å£ä¿¡æ¯
create table if not exists linksauce.`interface_info`
(
    `id` bigint not null auto_increment comment 'ä¸»é”®' primary key,
    `name` varchar(256) not null comment 'åç§°',
    `description` varchar(256) null comment 'æè¿°',
    `url` varchar(512) not null comment 'æ¥å£åœ°å€',
    `requestHeader` text null comment 'è¯·æ±‚å¤´',
    `responseHeader` text null comment 'å“åº”å¤´',
    `status` int default 0 not null comment 'æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ï¼Œ1-å¼€å¯ï¼‰',
    `method` varchar(256) not null comment 'è¯·æ±‚ç±»å‹',
    `userId` bigint not null comment 'åˆ›å»ºäºº',
    `createTime` datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    `updateTime` datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    `isDelete` tinyint default 0 not null comment 'æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )'
) comment 'æ¥å£ä¿¡æ¯';

insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å»–ç«‹è½©', 'è„±é¢–è€Œå‡º', 'www.foster-larkin.co', 'é¾™å˜‰æ‡¿', 'ç§¦å¤©ç£Š', 0, 'GET', 1718083101);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ›¹æ˜è¾‰', 'ä¸¾ä¸€åä¸‰', 'www.tony-kiehn.com', 'ä»»æ“è‹', 'é™ˆå‡¯ç‘', 0, 'GET', 28978);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('é‡‘ä¹é©¹', 'é¦–å½“å…¶å†²', 'www.coleen-prosacco.net', 'æ¯›æµ©', 'é™†è‡´è¿œ', 0, 'GET', 208);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å»–æ€', 'æ¥ä¹‹ä¸æ˜“', 'www.don-sipes.net', 'æ¢å½¬', 'ç™½å›æµ©', 0, 'GET', 470);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('è‘£ç…œç¥º', 'é•¿æ²»ä¹…å®‰', 'www.terry-turner.co', 'è¦ƒç»é½', 'èƒ¡é›ªæ¾', 0, 'GET', 611007);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('ä¾¯èªå¥', 'ç²¾å¿ƒè®¾è®¡', 'www.augustus-yost.info', 'å‚…é¸¿ç…Š', 'æ½˜é¹é£', 0, 'GET', 0);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('é­å¼˜æ–‡', 'ç©å¿½èŒå®ˆ', 'www.guadalupe-beatty.biz', 'æ±Ÿæ¢“æ™¨', 'é­æ€æ·¼', 0, 'GET', 1162536022);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('äºè‹‘åš', 'å„å¼å„æ ·', 'www.nolan-metz.net', 'éŸ¦æœ', 'é‡‘èƒ¤ç¥¥', 0, 'GET', 0);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å§šç‚«æ˜', 'ç¿»å¤©è¦†åœ°', 'www.jodie-schultz.info', 'è®¸è¶Šå½¬', 'æ¯›æ™‹é¹', 0, 'GET', 973);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å­™é‘«é¹', 'ç»œç»ä¸ç»', 'www.liza-sporer.co', 'å­™å½¬', 'å‚…é¸¿ç…Š', 0, 'GET', 30308);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å”å±•é¹', 'é“¤è€Œèµ°é™©', 'www.hayden-purdy.co', 'æ¨å“²ç€š', 'é™†å‡¯ç‘', 0, 'GET', 473462835);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ›¹æ“è‹', 'èµä¸ç»å£', 'www.phung-glover.org', 'é‚±å¿—æ³½', 'å¼ å¥é›„', 0, 'GET', 32155653);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å¤çƒ¨éœ–', 'å“­ç¬‘ä¸å¾—', 'www.augustine-funk.org', 'å®‹èªå¥', 'éƒé¹æ¶›', 0, 'GET', 3964);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('è‘£æµ©', 'å¯¹ç—‡ä¸‹è¯', 'www.erik-hamill.biz', 'é»ç«‹æœ', 'å»–é¹¤è½©', 0, 'GET', 2275);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('ç½—è£è½©', 'å–œé—»ä¹è§', 'www.gia-hermann.biz', 'éŸ©ç…œåŸ', 'é˜è€€æ°', 0, 'GET', 847);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ²ˆæ­£è±ª', 'ç»Ÿç­¹å…¼é¡¾', 'www.isabella-reinger.io', 'é‚“å­è½©', 'å»–ä¼Ÿè¯š', 0, 'GET', 997378602);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('ä»»ç«‹æœ', 'å‡ºäººæ„æ–™', 'www.geoffrey-koss.name', 'è¦ƒæµ©ç„¶', 'è§é›¨æ³½', 0, 'GET', 403);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('å¼ ç‚«æ˜', 'åä¸è™šä¼ ', 'www.ellan-gleason.com', 'é»æ­£è±ª', 'éŸ¦ç‚å½¬', 0, 'GET', 35127293);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('æ–¹é›¨æ³½', 'è¡£é£Ÿä½è¡Œ', 'www.wilton-walsh.biz', 'é»è¶Šæ³½', 'ç™½è¿œèˆª', 0, 'GET', 62264);
insert into linksauce.`interface_info` (`name`, `description`, `url`, `requestHeader`, `responseHeader`, `status`, `method`, `userId`) values ('è¢å¤©ç¿Š', 'å·åœŸé‡æ¥', 'www.lynetta-mclaughlin.info', 'é‚¹ç† å½¤', 'å¶æ½‡ç„¶', 0, 'GET', 9884455);
```

#### 2.3. MabatisXæ’ä»¶

ç”Ÿæˆdomainã€mapperã€service

æ‰“å¼€æ–°å»ºçš„è¡¨ï¼Œå³å‡»é€‰æ‹©MybatisX-Generator

å‹¾ä¸Šé©¼å³°

![image-20240329175949857](å¼€å‘æ–‡æ¡£.assets/image-20240329175949857.png)

æ ¹æ®**ç‰ˆæœ¬å’Œéœ€è¦æ‰“å‹¾**ï¼Œç‚¹å‡»å®Œæˆ

![image-20240329180554301](å¼€å‘æ–‡æ¡£.assets/image-20240329180554301.png)

#### 2.4. Controller

> æˆ‘ä»¬åªéœ€è¦å°†**PostController**å¤åˆ¶ä¸€ä»½æ”¹åä¸º**InterfaceInfoController**å³å¯,å› ä¸ºé€»è¾‘æ˜¯å·®ä¸å¤šï¼Œéƒ½æ˜¯è¿›è¡Œå¢åˆ æ”¹æŸ¥

ç„¶åå°†postæ”¹æˆinterfaceInfoã€Postæ”¹æˆInterfaceInfo

æ ¹æ®æŠ¥é”™ä¿¡æ¯æˆ‘ä»¬æ¥è¡¥å……ä¿¡æ¯



#### 2.5. Model

##### (1) Entity

```java
package com.ohh.project.model.entity;

import com.baomidou.mybatisplus.annotation.*;

import java.io.Serializable;
import java.util.Date;
import lombok.Data;

/**
 * æ¥å£ä¿¡æ¯
 * @TableName interface_info
 */
@TableName(value ="interface_info")
@Data
public class InterfaceInfo implements Serializable {
    /**
     * ä¸»é”®
     */
    @TableId(type = IdType.AUTO)
    private Long id;

    /**
     * åç§°
     */
    private String name;

    /**
     * æè¿°
     */
    private String description;

    /**
     * æ¥å£åœ°å€
     */
    private String url;

    /**
     * è¯·æ±‚å¤´
     */
    private String requestHeader;

    /**
     * å“åº”å¤´
     */
    private String responseHeader;

    /**
     * æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ï¼Œ1-å¼€å¯ï¼‰
     */
    private Integer status;

    /**
     * è¯·æ±‚ç±»å‹
     */
    private String method;

    /**
     * åˆ›å»ºäºº
     */
    private Long userId;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    /**
     * æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )
     */
    @TableLogic
    private Integer isDelete;

    @TableField(exist = false)
    private static final long serialVersionUID = 1L;
}
```

##### (2) DTO

é¦–å…ˆå…ˆå¢åŠ DTOï¼Œåœ¨InterfaceInfoç±»ä»æ‹¿æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯åšæˆä¸‰ä¸ªDTOç±»ï¼ˆåˆ†åˆ«æ˜¯æ–°å¢ã€æŸ¥è¯¢ã€æ›´æ–°ï¼‰åˆ é™¤çš„è¯·æ±‚æˆ‘ä»¬å°è£…åœ¨commonåŒ…ä¸‹

![image-20230112184904561](å¼€å‘æ–‡æ¡£.assets/image-20230112184904561.png)



#### 2.6. Service

æ ¹æ®æŠ¥é”™å¯çŸ¥ serviceå±‚ç¼ºå°‘ä¸€ä¸ªæ–¹æ³•validInterfaceInfo

```java
package com.ohh.project.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.ohh.project.common.ErrorCode;
import com.ohh.project.exception.BusinessException;
import com.ohh.project.mapper.InterfaceInfoMapper;
import com.ohh.project.model.entity.InterfaceInfo;
import com.ohh.project.service.InterfaceInfoService;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Service;

/**
* @author 12994
* @description é’ˆå¯¹è¡¨ã€interface_info(æ¥å£ä¿¡æ¯)ã€‘çš„æ•°æ®åº“æ“ä½œServiceå®ç°
* @createDate 2024-03-29 18:05:35
*/
@Service
public class InterfaceInfoServiceImpl extends ServiceImpl<InterfaceInfoMapper, InterfaceInfo>
    implements InterfaceInfoService {

    @Override
    public void validInterfaceInfo(InterfaceInfo interfaceInfo, boolean add) {
        if (interfaceInfo == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }

        String name = interfaceInfo.getName();
        String description = interfaceInfo.getDescription();
        String url = interfaceInfo.getUrl();
        String requestHeader = interfaceInfo.getRequestHeader();
        String responseHeader = interfaceInfo.getResponseHeader();
        Integer status = interfaceInfo.getStatus();
        String method = interfaceInfo.getMethod();
        Long userId = interfaceInfo.getUserId();

        // åˆ›å»ºæ—¶ï¼Œæ‰€æœ‰å‚æ•°å¿…é¡»éç©º
        if (add) {
            if (StringUtils.isAnyBlank(name, description, url, requestHeader, responseHeader, method) || ObjectUtils.anyNull(userId, status)) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR);
            }
        }
        if (StringUtils.isNotBlank(name) && name.length() > 256) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "åå­—è¿‡é•¿");
        }
        if (StringUtils.isNotBlank(description) && description.length() > 512) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "æè¿°è¿‡é•¿");
        }
    }

}

```

### 3ã€å‰ç«¯

#### 3.1. é…ç½®æ’ä»¶

ä¸ºäº†é¡¹ç›®æ›´åŠ è§„èŒƒ

> æœç´¢ **eslint** é€‰ä¸Šè‡ªåŠ¨è¯†åˆ«

![image-20230112193957977](å¼€å‘æ–‡æ¡£.assets/image-20230112193957977.png)



> æœç´¢**prettier** æ‰“âˆš  ç¾åŒ–ä»£ç 

![image-20230112194107217](å¼€å‘æ–‡æ¡£.assets/image-20230112194107217.png)

#### 3.2. æ¥å£è°ƒç”¨

ä½¿ç”¨ **oneapi** æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ

å¦‚æœè¦å‰ç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œéœ€è¦å°†åç«¯çš„éµå¾ª**openapi**è§„èŒƒçš„**json**æ–‡æ¡£ 

> åç«¯çš„éµå¾ª**openapi**è§„èŒƒçš„**json**æ–‡æ¡£ 

æ‰¾åˆ°æˆ‘ä»¬èµ·çš„åç«¯ä¸»é¡µ

æ‰¾åˆ°æˆ‘ä»¬èµ·çš„åç«¯ä¸»é¡µ

![image-20230112195321863](å¼€å‘æ–‡æ¡£.assets/image-20230112195321863-17118630680604.png)

åœ¨åœ°å€æ è¾“å…¥http://localhost:7529/api/v3/api-docs

å‘ç°å¦‚ä¸‹æ‰€ç¤º

![image-20240331133328390](å¼€å‘æ–‡æ¡£.assets/image-20240331133328390.png)

é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªurläº†

**ä¿®æ”¹ï¼š**`config\config.ts` ï¼Œæ‰¾åˆ°**openApi** ä¿®æ”¹å¦‚ä¸‹

```tsx
openAPI: [
    {
      requestLibPath: "import { request } from '@umijs/max'",
      schemaPath: 'http://localhost:7529/api/v3/api-docs',
      projectName: 'linksauce-backend',
    },
  ],
```

æµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½ç”¨

> æ‰¾åˆ°**package.json**,æ‰§è¡Œ**openapi**å‘½ä»¤
>
> ![image-20240331133404196](å¼€å‘æ–‡æ¡£.assets/image-20240331133404196.png)

æ‰§è¡ŒæˆåŠŸï¼ŒæŸ¥çœ‹**service**æ–‡ä»¶å¤¹

![image-20240331133533073](å¼€å‘æ–‡æ¡£.assets/image-20240331133533073.png)

ç”±äºæˆ‘ä»¬æœ‰åç«¯ ï¼Œåº”è¯·æ±‚çœŸå®ç¯å¢ƒï¼Œæ‰€ä»¥ç›´æ¥ç”¨**devæ¨¡å¼**è¿è¡Œ

```bash
npm run start:dev
```

å¯ä»¥å°†é¡¹ç›®ä¸­çš„`requestErrorConfig.ts`æ”¹ä¸º`requestConfig.ts`

ç„¶ååœ¨`app.tsx` æ‰¾åˆ° requesté…ç½®ï¼Œå°†å…¶ä¿®æ”¹æˆæˆ‘ä»¬æ”¹çš„

```java
export const request = {
  ...requestConfig,
};
```

**æ‰¾åˆ°`requestConfig.ts`**

ä¿®æ”¹åå­—ï¼Œå¹¶è®¾ç½®ä¸€ä¸‹åç«¯åœ°å€

**è®¾ç½®cookie!!!**

![image-20240331133754108](å¼€å‘æ–‡æ¡£.assets/image-20240331133754108.png)

> ```java
> baseURL: 'http://localhost:7529',
> withCredentials: true,
> ```

#### 3.3. ä¿®æ”¹ç™»å½•æ¥å£

æ‰¾åˆ°`src/pages/User/Login/index.tsx`ä¸‹çš„**handleSubmit**

ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç çš„å­—æ®µå’Œåç«¯ä¿æŒä¸€è‡´

**è®¾ç½®ç”¨æˆ·ç™»å½•æ€**

å›åˆ°`app.tsx`æ‰¾åˆ°**getInitialState()**è¿™ä¸ªæ–¹æ³•

è¿™ä¸ªæ–¹æ³•å½“é¦–æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œè·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè·å–å½“å‰å…¨å±€çš„ä¸€äº›çŠ¶æ€ï¼Œå¯ä»¥æŠŠå®ƒå½“æˆå…¨å±€å˜é‡

æ‰¾åˆ°`typings.d.ts`

```ts
/**
 * å…¨å±€çŠ¶æ€ç±»å‹
 */
interface InitialState{
  loginUser?:API.UserVO;
}
```

è¿”å›**getInitialState()**å°†å®ƒæ”¹ä¸º

```tsx
export async function getInitialState(): Promise<InitialState> {
  // å½“é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè·å–è¦å…¨å±€ä¿å­˜çš„æ•°æ®ï¼Œå¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯
  const state: InitialState = {
    loginUser: undefined,
  };
  try {
    const res = await getLoginUserUsingGet();
    if (res.data) {
      state.loginUser = res.data;
    }
  } catch (error) {
    history.push(loginPath);
  }
  return state;
}
```



è¿”å›`src/pages/User/Login/index.tsx`ä¸‹çš„**handleSubmit**

è®¾ç½®ç™»å½•çŠ¶æ€

```tsx
  const handleSubmit = async (values: API.UserLoginRequest) => {
    try {
      // ç™»å½•
      const res = await userLoginUsingPOST({ ...values });
      if (res.data) {
        const urlParams = new URL(window.location.href).searchParams;
        history.push(urlParams.get('redirect') || '/');
        setInitialState({
          loginUser: res.data
        });
        return;
      }
    } catch (error) {
      const defaultLoginFailureMessage = intl.formatMessage({
        id: 'pages.login.failure',
        defaultMessage: 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼',
      });
      console.log(error);
      message.error(defaultLoginFailureMessage);
    }
  };
```

#### 3.4. æ³¨é”€

æ‰¾åˆ°`src/components/RightContent/AvatarDropdown.tsx`çš„**loginout()**å°†å…¶æ”¹ä¸ºè‡ªå·±çš„åç«¯æ–¹æ³•

```java
const onMenuClick = useCallback(
  (event: MenuInfo) => {
    const { key } = event;
    if (key === 'logout') {
      flushSync(() => {
        setInitialState((s) => ({ ...s, currentUser: undefined }));
      });
      userLogoutUsingPost();
      return;
    }
    history.push(`/account/${key}`);
  },
  [setInitialState],
);
```

#### 3.5. è®¾ç½®ç®¡ç†æƒé™ 

ä¿®æ”¹`access.ts`

```ts
/**
 * @see https://umijs.org/docs/max/access#access
 * */
export default function access(initialState: InitialState | undefined) {
  const { loginUser } = initialState ?? {};
  return {
    // canAdmin: currentUser && currentUser.access === 'admin',
    canUser: loginUser,
    canAdmin: loginUser?.userRole === 'admin',
  };
}
 
```

#### 3.6. ä¿®æ”¹è¡¨æ ¼å†…å®¹

æ‰¾åˆ°`src/pages/TableList/index.tsx`çš„**columns**ï¼Œä¿®æ”¹å¦‚ä¸‹

```tsx
const columns: ProColumns<API.InterfaceInfo>[] = [
  {
    title: 'id',
    dataIndex: 'id',
    valueType: 'index',
  },
  {
    title: 'æ¥å£åç§°',
    dataIndex: 'name',
    valueType: 'text',
  },
  {
    title: 'æè¿°',
    dataIndex: 'description',
    valueType: 'textarea',
  },
  {
    title: 'è¯·æ±‚æ–¹æ³•',
    dataIndex: 'method',
    valueType: 'textarea',
  },
  {
    title: 'url',
    dataIndex: 'url',
    valueType: 'text',
  },
  {
    title: 'è¯·æ±‚å¤´',
    dataIndex: 'requestHeader',
    valueType: 'textarea',
  },
  {
    title: 'å“åº”å¤´',
    dataIndex: 'responseHeader',
    valueType: 'textarea',
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    hideInForm: true,
    valueEnum: {
      0: {
        text: 'å…³é—­',
        status: 'Default',
      },
      1: {
        text: 'è¿è¡Œä¸­',
        status: 'Processing',
      },
    },
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createTime',
    valueType: 'dateTime',
  },
  {
    title: 'æ›´æ–°æ—¶é—´',
    dataIndex: 'updateTime',
    valueType: 'dateTime',
  },
  {
    title: 'æ“ä½œ',
    dataIndex: 'option',
    valueType: 'option',
    render: (_, record) => [
      <a
        key="config"
        onClick={() => {
          handleUpdateModalOpen(true);
          setCurrentRow(record);
        }}
      >
        é…ç½®
      </a>,
      <a key="subscribeAlert" href="https://procomponents.ant.design/">
        è®¢é˜…è­¦æŠ¥
      </a>,
    ],
  },
];
```

ä¿®æ”¹`request`å¦‚ä¸‹ï¼š

```tsx
request={async (
  params: {
    pageSize?: number;
    current?: number;
    keyword?: string;
  }, sort: Record<string, SortOrder>,  filter: Record<string, React.ReactText[] | null>,) => {
  const res = await listInterfaceInfoByPageUsingGet({ ...params });
  if (res.data) {
    return {
      data: res.data.records || [],
      success: true,
      total: res.data.total,
    };
  } else {
    return {
      data: [],
      success: false,
      total: 0,
    };
  }
}}
```

**åˆ·æ–°é¡µé¢ï¼Œæ˜¾ç¤ºæˆåŠŸ**

![image-20240331135817432](å¼€å‘æ–‡æ¡£.assets/image-20240331135817432.png)



## äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥

### 1ã€ä¿®æ”¹è·¯ç”±

æ‰“å¼€**config**åŒ…æ‰¾åˆ° **routes.ts**

å°†åŸæ¥pagesä¸‹çš„**TableList**è¡¨å•åç§°æ”¹ä¸ºæˆ‘ä»¬çš„**interfaceInfo**ï¼Œå†æŠŠæ¥å£ç®¡ç†é¡µé¢é…ç½®åˆ°ç®¡ç†å‘˜é¡µé¢ä¸‹

```js
{
  name: 'æ¥å£ç®¡ç†',
  icon: 'table',
  path: '/admin/interface_info',
  component: './InterfaceInfo',
}
```



```typescript
export default [
  {
    path: '/user',
    layout: false,
    routes: [
      {
        name: 'login',
        path: '/user/login',
        component: './User/Login',
      },
    ],
  },
  {
    path: '/welcome',
    name: 'welcome',
    icon: 'smile',
    component: './Welcome',
  },
  {
    path: '/admin',
    name: 'admin',
    icon: 'crown',
    access: 'canAdmin',
    routes: [
      {
        path: '/admin',
        redirect: '/admin/sub-page',
      },
      {
        path: '/admin/sub-page',
        name: 'sub-page',
        component: './Admin',
      },
      {
        name: 'æ¥å£ç®¡ç†',
        icon: 'table',
        path: '/admin/interface_info',
        component: './InterfaceInfo',
      },
    ],
  },
  {
    path: '/',
    redirect: '/welcome',
  },
  {
    path: '*',
    layout: false,
    component: './404',
  },
];

```

æ•ˆæœå¦‚ä¸‹



### 2ã€æ–°å¢æ¥å£ä¿¡æ¯

---

#### 2.1. è¡¨å•æ¨¡å—

**interfaceInfo**ä¸­çš„**index.tsx**æ‰¾åˆ°æ–°å»ºçš„Button

![image-20230113153334776](å¼€å‘æ–‡æ¡£.assets/image-20230113153334776.png)

æˆ‘ä»¬ç‚¹å‡»æ–°å»ºçš„æ—¶å€™ï¼Œä»–ä¼šæ‰“å¼€ä¸€ä¸ªæ¨¡æ€æ¡†ã€‚å¾€ä¸‹æ‰¾ï¼Œå‘ç°å®ƒå·²ç»ç»™æˆ‘ä»¬æä¾›äº†è¿™ä¸ªç»„ä»¶ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦é‡æ–°å†™

![image-20230113153512970](å¼€å‘æ–‡æ¡£.assets/image-20230113153512970.png)

æˆ‘ä»¬å¯ä»¥å°±åƒæ›´æ–°æ¨¡æ€æ¡†ä¸€æ ·æ–°å»ºä¸€ä¸ªCreateModal.tsx

![image-20230113153639726](å¼€å‘æ–‡æ¡£.assets/image-20230113153639726.png)

æ¥ä¸‹æ¥ä¿®æ”¹ä»UpdateFormä¸­ç²˜è´´çš„**CreateModal.tsx**çš„ä»£ç 

```tsx
import { Modal } from 'antd';
import React from 'react';
import { ProColumns, ProTable } from '@ant-design/pro-components';
import '@umijs/max';

export type Props = {
  columns: ProColumns<API.InterfaceInfo>[];
  onCancel: () => void;
  onSubmit: (values: API.InterfaceInfo) => Promise<boolean>;
  open: boolean;
};

const CreateModal: React.FC<Props> = (props) => {
  const { columns, open, onCancel } = props;
  return (
    <Modal open={open} onCancel={() => onCancel?.()}>
      <ProTable columns={columns} />
    </Modal>
  );
};

export default CreateModal;
```

**è¿™é‡Œæˆ‘ä»¬å¤ç”¨äº†indexä¸­çš„columns**  è¿™é‡Œæˆ‘é¡ºä¾¿æŠŠå–æ¶ˆä¹Ÿå†™äº†

åœ¨**index.tsx**ä¸­ä½¿ç”¨

```tsx
  /**
   * @en-US Pop-up window of new window
   * @zh-CN æ–°å»ºçª—å£çš„å¼¹çª—
   *  */
  const [createModalOpen, handleModalOpen] = useState<boolean>(false);
	
 	const columns: ProColumns<API.InterfaceInfo>[] = [
    {
      title: 'id',
      dataIndex: 'id',
      valueType: 'index',
    },
   // ...
  ]

	// ...
	<CreateModal
    columns={columns}
    onCancel={() => handleModalOpen(false)}
    onSubmit={() => {}}
    open={createModalOpen}
  />
```

æµ‹è¯•ä¸€ä¸‹

![image-20230113164234500](å¼€å‘æ–‡æ¡£.assets/image-20230113164234500.png)

emmmm... è¿™æ˜¯ä»€ä¹ˆç©æ„??

æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œè¿™æ˜¯ProTableçš„é»˜è®¤type æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™å®ƒæŒ‡å®šä¸€ä¸ªformçš„type

```tsx
const CreateModal: React.FC<Props> = (props) => {
  const { columns, open, onCancel } = props;
  return (
    <Modal open={open} onCancel={() => onCancel?.()}>
      <ProTable columns={columns} type={'form'} />
    </Modal>
  );
};
```

å†æµ‹è¯•ä¸€ä¸‹å°±æ­£å¸¸å•¦~

![image-20230113164846052](å¼€å‘æ–‡æ¡£.assets/image-20230113164846052.png)

å‘ç°åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´æˆ‘ä»¬å¹¶ä¸éœ€è¦ã€‚å¢åŠ hideInFormå±æ€§

```tsx
    {
      title: 'åˆ›å»ºæ—¶é—´',
      dataIndex: 'createTime',
      valueType: 'dateTime',
      hideInForm: true,
    },
    {
      title: 'æ›´æ–°æ—¶é—´',
      dataIndex: 'updateTime',
      valueType: 'dateTime',
      hideInForm: true,
    },
```



#### 2.2. è¯·æ±‚åç«¯

**å…ˆç®€å•å¤„ç†ä¸€ä¸‹è¯·æ±‚æŠ¥é”™çš„æƒ…å†µ**

æ‰¾åˆ°`src/requestConfig.ts` ä¿®æ”¹ä¸€ä¸‹å“åº”æ‹¦æˆªå™¨

```typescript
  // å“åº”æ‹¦æˆªå™¨
  responseInterceptors: [
    (response) => {
      // æ‹¦æˆªå“åº”æ•°æ®ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å¤„ç†
      const { data } = response as unknown as ResponseStructure;
      console.log('data', data);
      if (data.code !== 0) {
        throw new Error(data.message);
      }
      return response;
    },
  ],
```

å†åœ¨`interfaceinfo/index.tsxä¸­`æ–°å¢è¯·æ±‚åç«¯çš„æ–¹æ³•

```tsx
  const handleAddInterfaceInfo = async (fields: API.InterfaceInfoAddRequest) => {
    const hide = message.loading('æ­£åœ¨æ·»åŠ ');
    try {
      await addInterfaceInfoUsingPOST({ ...fields });
      hide();
      message.success('åˆ›å»ºæˆåŠŸ!');
      // å…³é—­Modal
      handleModalOpen(false);
      return true;
    } catch (error: any) {
      hide();
      console.log(error);
      message.error('åˆ›å»ºå¤±è´¥!' + error.message);
      return false;
    }
  };

// ...

<CreateModal
  columns={columns}
  onCancel={() => handleModalOpen(false)}
  onSubmit={(values) => handleAddInterfaceInfo(values)}
  open={createModalOpen}
  />
```

å†ä¿®æ”¹`CreateModal.tsx`

```tsx
const CreateModal: React.FC<Props> = (props) => {
  const { columns, open, onCancel, onSubmit } = props;
  return (
    <Modal title={'æ–°å»ºæ¥å£'} open={open} onCancel={() => onCancel?.()}>
      <ProTable columns={columns} type={'form'} onSubmit={async (value) => onSubmit?.(value)} />
    </Modal>
  );
};
```



æµ‹è¯•æ·»åŠ æˆåŠŸ

![image-20230113183349785](å¼€å‘æ–‡æ¡£.assets/image-20230113183349785.png)





### 3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯

---

å…ˆæŠŠModalçš„footerå¹²æ‰   footer={null}

```ts
<Modal title={'æ›´æ–°æ¥å£'} footer={null} open={open} onCancel={() => onCancel?.()}>
		  // ...
  );
```



#### 3.1. è¡¨å•æ¨¡å—

æ–°å»ºæ–‡ä»¶`src/pages/InterfaceInfo/components/UpdateModal.tsx`

è¿™é‡Œä½¿ç”¨çš„useRefã€formRefå‚è€ƒäº†[å®˜æ–¹æ–‡æ¡£](https://procomponents.ant.design/components/table#%E9%80%9A%E8%BF%87-formref-%E6%9D%A5%E6%93%8D%E4%BD%9C%E6%9F%A5%E8%AF%A2%E8%A1%A8%E5%8D%95)

```tsx
import { Modal } from 'antd';
import React, {useEffect, useRef} from 'react';
import { ProColumns, ProFormInstance, ProTable } from '@ant-design/pro-components';
import '@umijs/max';

export type Props = {
  value: API.InterfaceInfo;
  columns: ProColumns<API.InterfaceInfoUpdateRequest>[];
  onCancel: () => void;
  onSubmit: (values: API.InterfaceInfoUpdateRequest) => Promise<void>;
  open: boolean;
};

const UpdateModal: React.FC<Props> = (props) => {
  const { value, columns, open, onCancel, onSubmit } = props;

  const formRef = useRef<ProFormInstance>();

  useEffect(() => {
    if (formRef) {
      formRef.current?.setFieldsValue(value);
    }
  }, [value]);

  return (
    <Modal title={'æ›´æ–°æ¥å£'} footer={null} open={open} onCancel={() => onCancel?.()}>
      <ProTable
        columns={columns}
        formRef={formRef}
        type={'form'}
        onSubmit={async (value) => onSubmit?.(value)}
        // è®¾ç½®é»˜è®¤å€¼
        form={{ initialValues: value }}
      />
    </Modal>
  );
};

export default UpdateModal;

```



#### 3.2. è¯·æ±‚åç«¯

åœ¨`interfaceinfo/index.tsx`ä¸­æ–°å¢è¯·æ±‚åç«¯çš„æ–¹æ³•

```tsx
  /**
   * @en-US Update InterfaceInfo
   * @zh-CN æ›´æ–°æ¥å£ä¿¡æ¯
   *
   * @param updateValue
   */
  const handleUpdateInterfaceInfo = async (updateValue: API.InterfaceInfoUpdateRequest) => {
    const hide = message.loading('æ­£åœ¨æ›´æ–°');
    try {
      let res = await updateInterfaceInfoUsingPOST({ ...updateValue });
      if (res.data) {
        hide();
        handleUpdateModalOpen(false);
        message.success('æ›´æ–°æˆåŠŸ!');
        return true;
      }
    } catch (error: any) {
      hide();
      message.error('æ›´æ–°å¤±è´¥!' + error.message);
      return false;
    }
  };      



// è¿™é‡Œçš„<UpdateModal/>ä»£ç æ˜¯åœ¨åŸæœ‰çš„ <UpdateForm/> åŸºç¡€ä¸Šé¢æ”¹çš„
<UpdateModal
        value={currentRow || {}}
        columns={columns}
        open={updateModalOpen}
        onSubmit={async (value) => {
          const success = await handleUpdateInterfaceInfo(value);
          if (success) {
            handleUpdateModalOpen(false);
            setCurrentRow(undefined);
            if (actionRef.current) {
              actionRef.current.reload();
            }
          }
        }}
        onCancel={() => {
          handleUpdateModalOpen(false);
          if (!showDetail) {
            setCurrentRow(undefined);
          }
        }}
      />
```

å‡ºé”™äº†ï¼ŒçŒœæµ‹æ˜¯Ant Design Proçš„é—®é¢˜ï¼ŒçŒœé”™äº†ï¼Œå…¶å®æ˜¯columnsä¸­çš„idçš„typeä¸ºindexçš„åŸå› ã€‚å¹¶æ²¡æœ‰idå­—æ®µï¼Œæ‰€ä»¥æˆ‘æ‰‹åŠ¨ç»™ä¸€ä¸‹

![image-20230113222955554](å¼€å‘æ–‡æ¡£.assets/image-20230113222955554.png)

ä¿®æ”¹ä»£ç å¦‚ä¸‹

```tsx
/**
   * @en-US Update InterfaceInfo
   * @zh-CN æ›´æ–°æ¥å£ä¿¡æ¯
   *
   * @param fields
   */
  const handleUpdateInterfaceInfo = async (fields: API.InterfaceInfoUpdateRequest) => {
    const hide = message.loading('æ­£åœ¨æ›´æ–°');
    try {
      if(!currentRow){
        return false;
      }
      let res = await updateInterfaceInfoUsingPOST({
        // å› ä¸ºcolumnsä¸­çš„id valueTypeä¸ºindex ä¸ä¼šä¼ é€’ æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨èµ‹å€¼id
        id: currentRow.id,
        ...fields,
      });
      if (res.data) {
        hide();
        handleUpdateModalOpen(false);
        message.success('æ›´æ–°æˆåŠŸ!');
        // åˆ·æ–°é¡µé¢
        actionRef.current?.reload();
        return true;
      }
    } catch (error: any) {
      hide();
      message.error('æ›´æ–°å¤±è´¥!' + error.message);
      return false;
    }
  };

```

æµ‹è¯•æ›´æ–°æˆåŠŸ~





### 4ã€åˆ é™¤æ¥å£ä¿¡æ¯

---

**åˆ é™¤æŒ‰é’®**

```tsx
// åœ¨columnsä¸­æ·»åŠ åˆ é™¤æŒ‰é’®	
{
      title: 'æ“ä½œ',
      dataIndex: 'option',
      valueType: 'option',
      render: (_, record) => [
        <a
          key="config"
          onClick={() => {
            handleUpdateModalOpen(true);
            setCurrentRow(record);
          }}
        >
          ç¼–è¾‘
        </a>,
        <a
          key="delete"
          onClick={() => {
            handleRemoveInterfaceInfo(record);
          }}
        >
          åˆ é™¤
        </a>,
      ],
    },
```

**è°ƒç”¨æ–¹æ³•**

```tsx
  const handleRemoveInterfaceInfo = async (record: API.InterfaceInfo) => {
    const hide = message.loading('æ­£åœ¨åˆ é™¤');
    if (!record) return true;
    try {
      await deleteInterfaceInfoUsingPOST({
        id: record.id,
      });
      hide();
      message.success('åˆ é™¤æˆåŠŸ!');
      // åˆ·æ–°é¡µé¢
      actionRef.current?.reload();
      return true;
    } catch (error: any) {
      hide();
      message.error('åˆ é™¤å¤±è´¥!' + error.message);
      return false;
    }
  };
```



æµ‹è¯•åˆ é™¤æˆåŠŸ~

![image-20230114154218713](å¼€å‘æ–‡æ¡£.assets/image-20230114154218713.png)



## ä¸‰ã€APIå¼€å‘

### 1ã€æ¨¡æ‹Ÿæ¥å£

**åˆ›å»ºé¡¹ç›®**

å¿«é€Ÿåˆ›å»ºä¸€ä¸ªspring Booté¡¹ç›® å‹¾é€‰

SpringWebã€Lombokã€Spring Boot DevTools



**æä¾›ä¸‰ä¸ªæ¨¡æ‹Ÿæ¥å£**

æ¥å£å¤§ä½“å†…å®¹

1.  GET æ¥å£
2.  POST æ¥å£ï¼ˆurlä¼ å‚ï¼‰
3.  POSTæ¥å£ï¼ˆRestfulï¼‰

ç®€å•çš„é¡¹ç›®ç»“æ„

```java
package com.ohh.linksauceinterface.controller;

import com.ohh.linksauceinterface.modal.User;
import org.springframework.web.bind.annotation.*;

/**
 * åç§°API
 */
@RestController
@RequestMapping("/name")
public class NameController {

    @GetMapping("/")
    public String getNameByGet(String name) {
        return "GET ä½ çš„åå­—æ˜¯" + name;
    }

    @PostMapping("/")
    public String getNameByPost(@RequestParam String name) {
        return "POST ä½ çš„åå­—æ˜¯" + name;
    }

    @PostMapping("/user")
    public String getUsernameByPost(@RequestBody User user) {
        return "POST ä½ çš„ç”¨æˆ·åæ˜¯" + user.getUsername();
    }


}
```

application.ymlé…ç½®ä¸€ä¸‹ç«¯å£ã€ç„¶åæŒ‡å®šä¸€ä¸‹å…¨å±€æ¥å£çš„åœ°å€

```yml
server:
  port: 8123
  servlet:
    context-path: /api
```



### 2ã€è°ƒç”¨æ¥å£

**å‡ ç§HTTPçš„è°ƒç”¨æ–¹å¼ï¼š**

1. HttpClient
2. RestTemplate
3. ç¬¬ä¸‰æ–¹åº“ï¼ˆOKHttpï¼ŒHutoolï¼‰

è¿™é‡Œæˆ‘ä½¿ç”¨äº†**Hutool**è°ƒç”¨		[hutoolæ–‡æ¡£](https://hutool.cn/docs/#/)

pomä¸­æ·»åŠ 

```xml
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.8.11</version>
</dependency>
```

æŸ¥çœ‹æ–‡æ¡£ä¸­çš„Httpè¯·æ±‚ç›¸å…³ç”¨æ³• ç¼–å†™`linkSauceClient`

```java
package com.ohh.linksauceinterface.client;

import cn.hutool.http.HttpRequest;
import cn.hutool.http.HttpResponse;
import cn.hutool.http.HttpUtil;
import cn.hutool.json.JSONUtil;
import com.ohh.linksauceinterface.modal.User;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.HashMap;

public class linkSauceClient {

    public String getNameByGet(String name) {
        // å¯ä»¥å•ç‹¬ä¼ å…¥httpå‚æ•°ï¼Œè¿™æ ·å‚æ•°ä¼šè‡ªåŠ¨åšURLç¼–ç ï¼Œæ‹¼æ¥åœ¨URLä¸­
        HashMap<String, Object> paramMap = new HashMap<>();
        paramMap.put("name", name);
        String result = HttpUtil.get("http://localhost:8123/api/name/", paramMap);
        System.out.println(result);
        return result;
    }

    public String getNameByPost(@RequestParam String name) {
        // å¯ä»¥å•ç‹¬ä¼ å…¥httpå‚æ•°ï¼Œè¿™æ ·å‚æ•°ä¼šè‡ªåŠ¨åšURLç¼–ç ï¼Œæ‹¼æ¥åœ¨URLä¸­
        HashMap<String, Object> paramMap = new HashMap<>();
        paramMap.put("name", name);
        String result = HttpUtil.post("http://localhost:8123/api/name/", paramMap);
        System.out.println(result);
        return result;
    }

    public String getUsernameByPost(@RequestBody User user) {
        String json = JSONUtil.toJsonStr(user);
        HttpResponse httpResponse = HttpRequest.post("http://localhost:8123/api/name/user")
                .body(json)
                .execute();
        System.out.println(httpResponse.getStatus());
        String result = httpResponse.body();
        System.out.println(result);
        return result;
    }

}
```

åˆ›å»ºæµ‹è¯•ç±»è°ƒç”¨æµ‹è¯•

![image-20240402233418619](å¼€å‘æ–‡æ¡£.assets/image-20240402233418619.png)



## å››ã€APIç­¾åè®¤è¯

**æœ¬è´¨ï¼š**

1.  ç­¾å‘ç­¾å
2.  ä½¿ç”¨ç­¾åï¼ˆæ ¡éªŒç­¾åï¼‰



**ä½œç”¨ï¼š**

ä¿è¯å®‰å…¨æ€§ï¼Œä¸èƒ½éšä¾¿ä¸€ä¸ªäººå°±å¯ä»¥è°ƒç”¨



**å®ç°æ–¹æ³•ï¼š**

-   **accessKey** 	è°ƒç”¨çš„æ ‡è¯†ï¼ˆå¤æ‚ï¼Œæ— åºï¼Œæ— è§„å¾‹ï¼‰
-   **secretKey**	å¯†é’¥ ï¼ˆå¤æ‚ï¼Œæ— åºï¼Œæ— è§„å¾‹ï¼‰	

ç±»ä¼¼**ç”¨æˆ·å**å’Œ**å¯†ç **ï¼ŒåŒºåˆ«ï¼šaccessKeyã€secretKeyæ˜¯**æ— çŠ¶æ€**çš„

åƒä¸‡ä¸èƒ½æŠŠå¯†é’¥ç›´æ¥åœ¨æœåŠ¡å™¨é—´è¿›è¡Œä¼ é€’ï¼Œæœ‰å¯èƒ½è¢«æ‹¦æˆª

åŠ å¯†çœ‹ç¬¬äºŒç‚¹



### 1ã€ä¿®æ”¹æ•°æ®åº“

ç”±äºæˆ‘ä»¬çš„**userè¡¨**é‡Œé¢æ²¡æœ‰**access_key**ã€**secret_key** æ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹æ•°æ®åº“è¡¨

```sql
create table if not exists user
(
    id            bigint auto_increment comment 'id' primary key,
    user_name     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    user_account  varchar(256)                           not null comment 'è´¦å·',
    user_avatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    gender        tinyint                                null comment 'æ€§åˆ«',
    user_role     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser / admin',
    user_password varchar(512)                           not null comment 'å¯†ç ',
    access_key    varchar(256)                           null comment 'access_key',
    secret_key    varchar(256)                           null comment 'secret_key',
    create_time   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    update_time   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    is_delete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    constraint uni_user_account
        unique (user_account)
) comment 'ç”¨æˆ·';
```

ç›´æ¥dropæ‰ä¹‹å‰çš„tableé‡æ–°å»ºè¡¨ï¼Œæ’å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ã€‚

æ ‡å‡†çš„è¯ åº”è¯¥æ–°å»ºä¸€ä¸ªè¡¨ ä¸»è¦å­—æ®µä¸ºæ¥å£idã€ä½¿ç”¨ç”¨æˆ·idã€access_keyã€secret_keyç­‰ç­‰



### 2ã€åŠ å¯†

---

#### 2.1. åŠ å¯†æ–¹å¼

å°†accessKeyã€secretKeyæ”¾åœ¨Headeré‡Œæ˜æ–‡ä¼ é€’å®‰å…¨å—

ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„**è¯·æ±‚å¯èƒ½è¢«äººæ‹¦æˆª**ï¼Œè€Œæˆ‘ä»¬æŠŠå¯†ç æ”¾è¿›è¯·æ±‚å¤´é‡Œé¢ï¼Œå¯èƒ½ä¼šè¢«åˆ«äººè·å–

> ä¸€èˆ¬æ˜¯æ ¹æ®å¯†é’¥ï¼Œç”Ÿæˆ**ç­¾åsign**

**åŠ å¯†æ–¹å¼**

1.  â€‹	å¯¹ç§°åŠ å¯†

2.  â€‹	éå¯¹ç§°åŠ å¯†

3.  â€‹	md5 ç­¾åï¼ˆä¸å¯è§£å¯†ï¼‰



**ç­¾åçš„åšæ³•**

å‡å¦‚ ï¼Œæˆ‘ä»¬æœ‰ç”¨æˆ·å‚æ•°ï¼Œæˆ‘ä»¬ç”¨å¯†é’¥ä¸ä»–æ‹¼æ¥ï¼Œç”¨ç­¾åç®—æ³•å¾—åˆ°ä¸€ä¸ªä¸å¯è§£å¯†çš„å€¼

â€‹			**ç”¨æˆ·å‚æ•° 	+	å¯†é’¥	=>	ç­¾åç”Ÿæˆç®—æ³•ï¼ˆMD5,HMac,Sha1) 	=>	ä¸å¯è§£å¯†çš„å€¼**

ä¾‹å­ï¼š	xuan 	+	abc	=>	7e7b9583aa0bc3e834fe8bcaebda38b5ï¼ˆè¿™é‡Œæ˜¯æˆ‘éšä¾¿è¾“çš„ï¼Œå¾—åˆ°çš„å€¼æ˜¯éšæœºçš„ï¼‰

æ€ä¹ˆçŸ¥é“ç­¾åå¯¹ä¸å¯¹ï¼Ÿ

æœåŠ¡ç«¯ç”¨ä¸€æ¨¡ä¸€æ ·çš„å‚æ•°å’Œç®—æ³•å»ç”Ÿæˆç­¾åï¼Œåªè¦å’Œç”¨æˆ·ä¼ çš„ä¸€è‡´ï¼Œå°±è¡¨ç¤ºå¯†é’¥ä¸€è‡´



**æ€ä¹ˆé˜²é‡æ”¾ï¼Ÿ**

åŠ nonceéšæœºæ•°	åªèƒ½ç”¨ä¸€æ¬¡

æœåŠ¡ç«¯è¦ä¿å­˜ç”¨è¿‡çš„éšæœºæ•°	

åŠ timestamp æ—¶é—´æˆ³ï¼Œæ ¡éªŒå®ƒçš„æœ‰æ•ˆæœŸ



ç»¼ä¸Šæ‰€å±

**ä¼ é€’çš„å‚æ•°**

1.  accessKey
2.  sign ï¼ˆç”±accessKey(æˆ–è€…ä½¿ç”¨ç”¨æˆ·è¯·æ±‚å‚æ•°bodyç­‰)ã€secretKeyåŠ å¯†è€Œæ¥ï¼‰
3.  nonceéšæœºæ•°
4.  timestamp
5.  bodyï¼ˆç”¨æˆ·è¯·æ±‚å‚æ•° å¯è¦å¯ä¸è¦ï¼‰

**APIç­¾åè®¤è¯æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„è®¾è®¡ï¼Œå…·ä½“è¦æœ‰å“ªäº›å‚æ•°ï¼Œå°½é‡æœåŠ¡ç«¯è°ƒç”¨ï¼Œå‚æ•°åå¦‚ä½•è¦æ ¹æ®åœºæ™¯æ¥ã€‚**



#### 2.2. åŠ å¯†ä»£ç 

æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨äº†bodyã€å’ŒsecretKeyè¿›è¡ŒåŠ å¯†

å…ˆåˆ›å»ºä¸€ä¸ªåŠ å¯†ç­¾åç±»`SignUtil.java`

```java
package com.ohh.linksauceinterface.utils;

import cn.hutool.crypto.digest.DigestAlgorithm;
import cn.hutool.crypto.digest.Digester;

/**
 * ç­¾åå·¥å…·
 */
public class SignUtils {
    /**
     * ç”Ÿæˆç­¾å
     *
     * @param body
     * @param secretKey
     * @return
     */
    public static String genSign(String body, String secretKey) {
        Digester md5 = new Digester(DigestAlgorithm.SHA256);
        String content = body + "." + secretKey;
        return md5.digestHex(content);
    }
}

```



åœ¨Clientç±»ä¸­æ–°å¢æ„é€ Headerçš„æ–¹æ³•

```java
public class linkSauceClient {

    private String accessKey;
    private String secretKey;
  
	// ...

 private Map<String, String> getHeaderMap(String body) {
        Map<String, String> hashMap = new HashMap<>();
        hashMap.put("accessKey", accessKey);
        // ä¸èƒ½ç›´æ¥å‘é€
        // hashMap.put("secretKey", secretKey);
        hashMap.put("nonce", RandomUtil.randomNumbers(4));
        hashMap.put("body", body);
        hashMap.put("timestamp", String.valueOf(System.currentTimeMillis() / 1000));
        hashMap.put("sign", genSign(body, secretKey));
        return hashMap;
    }

    public String getUsernameByPost(@RequestBody User user) {
        String json = JSONUtil.toJsonStr(user);
        HttpResponse httpResponse = HttpRequest.post("http://localhost:8123/api/name/user")
                .addHeaders(getHeaderMap(json))
                .body(json)
                .execute();
        System.out.println(httpResponse.getStatus());
        String result = httpResponse.body();
        System.out.println(result);
        return result;
    }

}
```



è°ƒç”¨APIçš„æ—¶å€™åŠ å¯†ä»£ç å·²ç»å†™å¥½äº†ï¼Œæ˜¾ç„¶æˆ‘ä»¬åœ¨APIä¸­éœ€è¦ç”¨åŒæ ·çš„æ–¹æ³•æ¥éªŒè¯åŠ å¯†ã€‚è¿™é‡Œä»¥æºå¸¦JSON bodyçš„POSTè¯·æ±‚ä¸ºä¾‹

```java
package com.ohh.linksauceinterface.controller;

import com.ohh.linksauceinterface.modal.User;
import com.ohh.linksauceinterface.utils.SignUtils;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletRequest;

/**
 * åç§°API
 */
@RestController
@RequestMapping("/name")
public class NameController {

    @GetMapping("/")
    public String getNameByGet(String name) {
        return "GET ä½ çš„åå­—æ˜¯" + name;
    }

    @PostMapping("/")
    public String getNameByPost(@RequestParam String name) {
        return "POST ä½ çš„åå­—æ˜¯" + name;
    }

    @PostMapping("/user")
    public String getUsernameByPost(@RequestBody User user, HttpServletRequest request) {
        String accessKey = request.getHeader("accessKey");
        String nonce = request.getHeader("nonce");
        String timestamp = request.getHeader("timestamp");
        String sign = request.getHeader("sign");
        String body = request.getHeader("body");
        // todo å®é™…å¼€å‘åº”å»æ•°æ®åº“ä¸­æŸ¥çœ‹æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·
        if (!accessKey.equals("ohh")) {
            throw new RuntimeException("æ— æƒé™è®¿é—®");
        }
        if (Long.parseLong(nonce) > 10000) {
            throw new RuntimeException("æ— æƒé™è®¿é—®");
        }
        // todo æ—¶é—´å’Œå½“å‰æ—¶é—´ä¸èƒ½è¶…è¿‡5åˆ†é’Ÿ
        // if (timestamp){
        //
        // }

        // todo å®é™…æƒ…å†µæ˜¯ä»æ•°æ®åº“ä¸­æŸ¥secretKey
        String serverSign = SignUtils.genSign(body, "abcdefgh");
        if (!sign.equals(serverSign)) {
            throw new RuntimeException("ç­¾åé”™è¯¯");
        }

        return "POST ä½ çš„ç”¨æˆ·åæ˜¯" + user.getUsername();
    }


}

```

è¿›è¡Œæµ‹è¯•secretKey = "abc" å¯ä»¥æ­£ç¡®è®¿é—®ï¼Œå½“secreté”™è¯¯æ—¶è¿”å›æ— æƒé™ï½



## äº”ã€å¼€å‘ä¸€ä¸ªSDKï¼ˆstarterï¼‰

ç†æƒ³æƒ…å†µï¼šå¼€å‘è€…åªéœ€è¦å…³å¿ƒè°ƒç”¨å“ªäº›æ¥å£ã€ä¼ é€’å“ªäº›å‚æ•°ã€‚å°±è·Ÿè°ƒç”¨è‡ªå·±å†™çš„ä»£ç ä¸€æ ·ç®€å•ã€‚

> å¼€å‘starterçš„å¥½å¤„ï¼šå¼€å‘è€…å¼•å…¥ä¹‹åï¼Œå¯ä»¥ç›´æ¥åœ¨application.ymlä¸­å†™é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºå®¢æˆ·ç«¯

### 1ã€æ–°å»ºé¡¹ç›®

åˆ›å»ºä¸€ä¸ª`linksauce-client-sdk`çš„springbooté¡¹ç›® å‹¾é€‰lombokã€Spring Configuration Processor

ï¼ˆä½œç”¨ï¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®çš„ä»£ç æç¤ºï¼‰

ç„¶åå¤„ç†`pom.xml`  <build></build>è¿™ä¸ª<font color='red'>ä¸€å®šéœ€è¦åˆ é™¤</font>å› ä¸ºè¿™ä¸ªæ˜¯mavençš„æ„å»ºé¡¹ç›®æˆå¯è¿è¡ŒjaråŒ…ã€‚ç°åœ¨æ˜¯åˆ¶ä½œstarterä¾èµ–åŒ…

![image-20230116142827466](å¼€å‘æ–‡æ¡£.assets/image-20230116142827466-17121502607301.png)



### 2ã€ç¼–å†™é…ç½®ç±»

æˆ‘ä»¬ä¸éœ€è¦spring bootå¯åŠ¨ç±»ï¼Œå°†å…¶åˆ å»ã€‚

ç„¶åå°†ä¹‹å‰ç¼–å†™å¥½çš„clientã€utilã€modelç²˜è´´è¿‡æ¥

![image-20240403211904794](å¼€å‘æ–‡æ¡£.assets/image-20240403211904794.png)

å†æ–°å»ºé…ç½®ç±»`LinkSauceClientConfig`

```java
@Configuration
@ConfigurationProperties("linksauce.client")
@Data
@ComponentScan
public class LinkSauceClientConfig {

    private String accessKey;
    private String secretKey;

    @Bean
    public linkSauceClient linkSauceClient() {
        return new linkSauceClient(accessKey, secretKey);
    }

}
```



### 3ã€æŒ‡å®šé…ç½®ç±»

æ–°å»º`resources/META-INF/spring.factories`å¹¶æŒ‡å®š

```properties
# spring boot starter
org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.xuan.XuanApiClientConfig
```

![image-20240403212126780](å¼€å‘æ–‡æ¡£.assets/image-20240403212126780.png)



### 4ã€å‘å¸ƒstarter

åŒå‡»Maven lifecycleä¸‹çš„**install**æˆ–è€…å‘½ä»¤è¡Œ`mvn install`

![image-20240403212248335](å¼€å‘æ–‡æ¡£.assets/image-20240403212248335.png)



### 5ã€æµ‹è¯•

**å¼•å…¥ä¾èµ–**

å›åˆ°`linksauce-Interface`é¡¹ç›®ï¼ŒæŠŠä¹‹å‰çš„**client**ã€**util**ã€**model**å…¨éƒ¨åˆ æ‰ã€‚ç„¶ååœ¨**pom**ä¸­å¼•å…¥æˆ‘ä»¬åˆšåˆšåˆ¶ä½œå¥½çš„starter

<font color='red'>æ³¨æ„ï¼š</font>è¿™é‡Œèƒ½ç›´æ¥å¼•å…¥ï¼Œæ˜¯å› ä¸ºåˆšåˆšæˆ‘ä»¬installçš„stateråœ¨æˆ‘ä»¬çš„æœ¬åœ°ï¼Œå¯ä»¥å‘å¸ƒåˆ°Mavenä»“åº“æˆ–è€…æä¾›jaråŒ…ä¾›å¤§å®¶ä½¿ç”¨ã€‚

```xml
<!--è‡ªå·±åˆ¶ä½œçš„starter-->
<dependency>
  <groupId>com.linksauce</groupId>
  <artifactId>linksauce-client-sdk</artifactId>
  <version>0.0.1</version>
</dependency>
```



**é…ç½®ä¿¡æ¯**

![image-20240403212604953](å¼€å‘æ–‡æ¡£.assets/image-20240403212604953.png)

> åœ¨ymlæ–‡ä»¶ä¸­é…ç½®çš„æ—¶å€™æœ‰æç¤ºå°±æ˜¯ä¹‹å‰å¼•å…¥çš„Spring Configuration Processorå‘æŒ¥çš„ä½œç”¨ã€‚



åœ¨æµ‹è¯•ç±»ä½¿ç”¨@Resourceæ³¨å…¥linkSauceClientè¿›è¡Œæµ‹è¯•

![image-20240403212738869](å¼€å‘æ–‡æ¡£.assets/image-20240403212738869.png)



## å…­ã€æ¥å£å‘å¸ƒ/ä¸‹çº¿

è¿™ä¸ªåŠŸèƒ½é¦–å…ˆæ˜¯ä»…ç®¡ç†å‘˜ä½¿ç”¨çš„

**å‘å¸ƒæ¥å£**

1.  æ ¡éªŒè¯¥æ¥å£æ˜¯å¦å­˜åœ¨
2.  åˆ¤æ–­æ¥å£æ˜¯å¦å¯ä»¥è¢«è°ƒç”¨
3.  ä¿®æ”¹æ•°æ®åº“æ¥å£å­—æ®µä¸º1

**ä¸‹çº¿æ¥å£**

1.  æ ¡éªŒè¯¥æ¥å£æ˜¯å¦å­˜åœ¨
2.  ä¿®æ”¹æ•°æ®åº“æ¥å£å­—æ®µä¸º 0

### 1ã€åç«¯



1.   **é€šç”¨è¯·æ±‚ç±»**

     ä¸Šä¸‹çº¿éƒ½æ˜¯é€šè¿‡idæ¥æ§åˆ¶çš„

     ```java
     /**
      * é€šè¿‡idå‘é€è¯·æ±‚
      *
      * @author ohh
      */
     @Data
     public class IdRequest implements Serializable {
         /**
          * id
          */
         private Long id;
     
         private static final long serialVersionUID = 1L;
     }
     ```

2.   **æšä¸¾ç±»**

     ä½¿ç”¨æšä¸¾ç±»æ¥è¡¨ç¤ºä¸Šçº¿/ä¸‹çº¿çŠ¶æ€

     ```java
     package com.ohh.project.model.enums;
     
     import java.util.Arrays;
     import java.util.List;
     import java.util.stream.Collectors;
     
     /**
      * æ¥å£ä¿¡æ¯çŠ¶æ€æšä¸¾
      *
      * @author ohh
      */
     public enum InterfaceInfoStatusEnum {
     
         OFFLINE("å…³é—­", 0),
         ONLINE("ä¸Šçº¿", 1);
     
         private final String text;
     
         private final int value;
     
         InterfaceInfoStatusEnum(String text, int value) {
             this.text = text;
             this.value = value;
         }
     
         /**
          * è·å–å€¼åˆ—è¡¨
          *
          * @return
          */
         public static List<Integer> getValues() {
             return Arrays.stream(values()).map(item -> item.value).collect(Collectors.toList());
         }
     
         public int getValue() {
             return value;
         }
     
         public String getText() {
             return text;
         }
     }
     ```

3.   **åœ¨controlleré‡Œç¼–å†™ä¸Šä¸‹çº¿ä»£ç **

     <font color='red'>è¿™é‡Œæœ‰ä¸ªTODO</font> åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨æ—¶ï¼Œç”±`linksauceClient`å›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨

     ```java
     package com.ohh.project.controller;
     
     import ...
     
     /**
      * æ¥å£ç®¡ç†
      *
      * @author ohh
      */
     @RestController
     @RequestMapping("/interfaceInfo")
     @Slf4j
     public class InterfaceInfoController {
     
         @Resource
         private InterfaceInfoService interfaceInfoService;
     
         @Resource
         private UserService userService;
     
         @Resource
         private linkSauceClient linkSauceClient;
     
       // ...
      
         /**
          * å‘å¸ƒ
          *
          * @param idRequest
          * @param request
          * @return
          */
         @PostMapping("/online")
         @AuthCheck(mustRole = "admin")
         public BaseResponse<Boolean> onlineInterfaceInfo(@RequestBody IdRequest idRequest, HttpServletRequest request) {
     
             if (idRequest == null || idRequest.getId() <= 0) {
                 throw new BusinessException(ErrorCode.PARAMS_ERROR);
             }
             long id = idRequest.getId();
             // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
             InterfaceInfo oldInterfaceInfo = interfaceInfoService.getById(id);
             if (oldInterfaceInfo == null) {
                 throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);
             }
             // åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨
             com.linksauce.linksauceclientsdk.model.User user = new com.linksauce.linksauceclientsdk.model.User();
             user.setUsername("test");
             String username = linkSauceClient.getNameByPostWithJson(user);
             if (StringUtils.isBlank(username)) {
                 throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ¥å£éªŒè¯å¤±è´¥");
             }
             // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ä¿®æ”¹
             InterfaceInfo interfaceInfo = new InterfaceInfo();
             interfaceInfo.setId(id);
             interfaceInfo.setStatus(InterfaceInfoStatusEnum.ONLINE.getValue());
             boolean result = interfaceInfoService.updateById(interfaceInfo);
             return ResultUtils.success(result);
         }
     
         /**
          * ä¸‹çº¿
          *
          * @param idRequest
          * @param request
          * @return
          */
         @PostMapping("/offline")
         @AuthCheck(mustRole = "admin")
         public BaseResponse<Boolean> offlineInterfaceInfo(@RequestBody IdRequest idRequest, HttpServletRequest request) {
             if (idRequest == null || idRequest.getId() <= 0) {
                 throw new BusinessException(ErrorCode.PARAMS_ERROR);
             }
             long id = idRequest.getId();
             // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
             InterfaceInfo oldInterfaceInfo = interfaceInfoService.getById(id);
             if (oldInterfaceInfo == null) {
                 throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);
             }
     
             // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ä¿®æ”¹
             InterfaceInfo interfaceInfo = new InterfaceInfo();
             interfaceInfo.setId(id);
             interfaceInfo.setStatus(InterfaceInfoStatusEnum.OFFLINE.getValue());
             boolean result = interfaceInfoService.updateById(interfaceInfo);
             return ResultUtils.success(result);
         }
     }
     ```

4.   **æƒé™æ§åˆ¶**

     è¿™é‡Œæ·»åŠ æƒé™æ ¡éªŒï¼Œè¿™é‡Œç”¨åˆ°**@AuthCheck(mustRole = "admin")**çš„åˆ‡é¢æ³¨è§£ï¼Œå¯¹åº”çš„å®ç°æ–¹æ³•åœ¨`aop/AuthInterceptor`

     ```java
     package com.ohh.project.annotation;
     
     // import ...
     
     /**
      * æƒé™æ ¡éªŒ
      *
      * @author ohh
      */
     @Target(ElementType.METHOD)
     @Retention(RetentionPolicy.RUNTIME)
     public @interface AuthCheck {
     
         /**
          * æœ‰ä»»ä½•ä¸€ä¸ªè§’è‰²
          *
          * @return
          */
         String[] anyRole() default "";
     
         /**
          * å¿…é¡»æœ‰æŸä¸ªè§’è‰²
          *
          * @return
          */
         String mustRole() default "";
     
     }
     ```

     `aop/AuthInterceptor.java`

     ```java
     package com.ohh.project.aop;
     
     // import...
     
     import javax.annotation.Resource;
     import javax.servlet.http.HttpServletRequest;
     import java.util.Arrays;
     import java.util.List;
     import java.util.stream.Collectors;
     
     
     /**
      * æƒé™æ ¡éªŒ AOP
      *
      * @author ohh
      */
     @Aspect
     @Component
     public class AuthInterceptor {
     
         @Resource
         private UserService userService;
     
         /**
          * æ‰§è¡Œæ‹¦æˆª
          *
          * @param joinPoint
          * @param authCheck
          * @return
          */
         @Around("@annotation(authCheck)")
         public Object doInterceptor(ProceedingJoinPoint joinPoint, AuthCheck authCheck) throws Throwable {
             List<String> anyRole = Arrays.stream(authCheck.anyRole()).filter(StringUtils::isNotBlank).collect(Collectors.toList());
             String mustRole = authCheck.mustRole();
             RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
             HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
             // å½“å‰ç™»å½•ç”¨æˆ·
             User user = userService.getLoginUser(request);
             // æ‹¥æœ‰ä»»æ„æƒé™å³é€šè¿‡
             if (CollectionUtils.isNotEmpty(anyRole)) {
                 String userRole = user.getUserRole();
                 if (!anyRole.contains(userRole)) {
                     throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
                 }
             }
             // å¿…é¡»æœ‰æ‰€æœ‰æƒé™æ‰é€šè¿‡
             if (StringUtils.isNotBlank(mustRole)) {
                 String userRole = user.getUserRole();
                 if (!mustRole.equals(userRole)) {
                     throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
                 }
             }
             // é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œ
             return joinPoint.proceed();
         }
     }
     ```

     `userService.getLoginUser(request)`

     ```java
     /**
      * è·å–å½“å‰ç™»å½•ç”¨æˆ·
      *
      * @param request
      * @return
      */
     @Override
     public User getLoginUser(HttpServletRequest request) {
         // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
         Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
         User currentUser = (User) userObj;
         if (currentUser == null || currentUser.getId() == null) {
             throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
         }
         // ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè¿½æ±‚æ€§èƒ½çš„è¯å¯ä»¥æ³¨é‡Šï¼Œç›´æ¥èµ°ç¼“å­˜ï¼‰
         long userId = currentUser.getId();
         currentUser = this.getById(userId);
         if (currentUser == null) {
             throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
         }
         return currentUser;
     }
     ```



### 2ã€å‰ç«¯

#### 2.1. æ·»åŠ å‘å¸ƒæŒ‰é’®å’Œä¸‹çº¿æŒ‰é’®

> Ant Design [Buttonçš„å®˜æ–¹æ–‡æ¡£](https://ant.design/components/button-cn)

å‘å¸ƒ/ä¸‹çº¿åšæˆä¸€ä¸ªæŒ‰é’®ã€‚é€šè¿‡statusæ¥åŠ¨æ€åˆ¤æ–­

```tsx
{
  title: 'æ“ä½œ',
  dataIndex: 'option',
  valueType: 'option',
  render: (_, record) => [
    <a
      key="config"
      onClick={() => {
        handleUpdateModalOpen(true);
        setCurrentRow(record);
      }}
    >
      ä¿®æ”¹
    </a>,
    record.status === 0 ? (
      <a
        key="config"
        onClick={() => {
          handleOnline(record);
        }}
      >
        å‘å¸ƒ
      </a>
    ) : null,
    record.status === 1 ? (
      <Button
        type="text"
        danger
        key="config"
        onClick={() => {
          handleOFFline(record);
        }}
      >
        ä¸‹çº¿
      </Button>
    ) : null,
    <Button
      type="text"
      danger
      key="delete"
      onClick={() => {
        handleRemoveInterfaceInfo(record);
      }}
    >
      åˆ é™¤
    </Button>,
  ],
},
```

è¿è¡Œæˆªå›¾ï¼š

![image-20240405145945492](å¼€å‘æ–‡æ¡£.assets/image-20240405145945492.png)

#### 2.2. ç¼–å†™å‘å¸ƒ/ä¸‹çº¿çš„æ–¹æ³•

<font color='red'>å› ä¸ºåç«¯æ–°å¢äº†ä»£ç ï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨openapiè‡ªåŠ¨ç”Ÿæˆå‰ç«¯æ–¹æ³•</font>

è·Ÿä¹‹å‰æ“ä½œä¸€æ ·ï¼Œå»http://localhost:7529/api/v3/api-docså¤åˆ¶jsonåˆ°config/oneapi.json ç„¶åè¿è¡Œopenapi   

æ–°å¢æ–¹æ³•

```tsx
/**
 * å‘å¸ƒæ¥å£
 * @param selectedRows
 */
const handleOnline = async (record: API.IdRequest) => {
  const hide = message.loading('å‘å¸ƒä¸­');
  if (!record) return true;
  try {
    await onlineInterfaceInfoUsingPost({
      id: record.id,
    });
    hide();
    message.success('å‘å¸ƒæˆåŠŸ!');
    // åˆ·æ–°é¡µé¢
    actionRef.current?.reload();
    return true;
  } catch (error: any) {
    hide();
    message.error('å‘å¸ƒå¤±è´¥!' + error.message);
    return false;
  }
};

/**
 * ä¸‹çº¿æ¥å£
 * @param selectedRows
 */
const handleOFFline = async (record: API.IdRequest) => {
  const hide = message.loading('ä¸‹çº¿ä¸­');
  if (!record) return true;
  try {
    await offlineInterfaceInfoUsingPost({
      id: record.id,
    });
    hide();
    message.success('ä¸‹çº¿æˆåŠŸ!');
    // åˆ·æ–°é¡µé¢
    actionRef.current?.reload();
    return true;
  } catch (error: any) {
    hide();
    message.error('ä¸‹çº¿å¤±è´¥!' + error.message);
    return false;
  }
};
```



## ä¸ƒã€ç”¨æˆ·ä¸»é¡µ

>  å‰ç«¯æµè§ˆæ¥å£ï¼ŒæŸ¥çœ‹æ¥å£æ–‡æ¡£ï¼Œç”³è¯·ç­¾åï¼ˆæ³¨å†Œï¼‰

### 1ã€æµè§ˆæ¥å£

---

åœ¨`src/pages`ç›®å½•ä¸‹æ–°å»º**Index**ç›®å½•å¹¶æŠŠ`Welcome.tsx`æ‹–å…¥å…¶ä¸­

æ”¹åä¸º`index.tsx`



**é…ç½®è·¯ç”±**`routes.tsx`

```ts
  { name: 'ä¸»é¡µ', path: '/', icon: 'smile', component: './Index' },
```



**ç¼–å†™é¡µé¢**`Index/index.tsx`

>  å‚è€ƒ [Ant Design Listç»„ä»¶](https://ant.design/components/list-cn)

```tsx
import { listInterfaceInfoByPageUsingGet } from '@/services/linksauce-backend/interfaceInfoController';
import { PageContainer } from '@ant-design/pro-components';
import { List, message } from 'antd';
import React, { useEffect, useState } from 'react';

/**
 * ä¸»é¡µ
 * @constructor
 */
const Index: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const [list, setList] = useState<API.InterfaceInfo[]>([]);
  const [total, setTotal] = useState<number>(0);

  const loadData = async (current = 1, pageSize = 10) => {
    setLoading(true);
    try {
      const res = await listInterfaceInfoByPageUsingGet({
        current,
        pageSize,
      });
      setList(res?.data?.records ?? []);
      setTotal(res?.data?.total ?? 0);
      setLoading(false);
    } catch (error: any) {
      setLoading(false);
      message.error('è¯·æ±‚å¤±è´¥,' + error.message);
    }
  };

  useEffect(() => {
    loadData();
  }, []);

  return (
    <PageContainer title={'åœ¨çº¿æ¥å£å¼€æ”¾å¹³å°'}>
      <List
        className="interfaceInfo-list"
        loading={loading}
        itemLayout="horizontal"
        dataSource={list}
        pagination={{
          showSizeChanger: true,
          total: total,
          showTotal(total, range) {
            return `${range[0]}-${range[1]} / ${total}`;
          },
          onChange(page, pageSize) {
            loadData(page, pageSize);
          },
        }}
        renderItem={(item) => {
          const apiLink = `/interface_info/${item.id}`;
          return (
            <List.Item actions={[<a key={item.id} href={apiLink}>æŸ¥çœ‹è¯¦æƒ…</a>]}>
              <List.Item.Meta
                title={<a href={apiLink}>{item.name}</a>}
                description={item.description}
              />
              <div>{item.method}</div>
            </List.Item>
          );
        }}
      />
    </PageContainer>
  );
};

export default Index;
```



**æ•ˆæœå¦‚ä¸‹**

![image-20240405162809892](å¼€å‘æ–‡æ¡£.assets/image-20240405162809892.png)



### 2ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£

---

1.   **æ–°å»ºæ–‡ä»¶**

     åœ¨**pages**ä¸‹æ–°å»º `InterfaceInfo/index.tsx`

2.   **é…ç½®åŠ¨æ€è·¯ç”±**`routes.ts`

     > æŸ¥çœ‹ [umiæ–‡æ¡£](https://umijs.org/docs/guides/routes)

     ```ts
     {
       name: 'æŸ¥çœ‹æ¥å£',
       path: '/interface_info/:id',
       icon: 'smile',
       component: './InterfaceInfo',
       hideInMenu: true,
     },
     ```

3.   **ä¿®æ”¹è·³è½¬**

     ä¸»é¡µä»£ç ç‰‡æ®µä¿®æ”¹

     ```tsx
     return (
       <PageContainer title={'åœ¨çº¿æ¥å£å¼€æ”¾å¹³å°'}>
         <List
           className="interfaceInfo-list"
           loading={loading}
           itemLayout="horizontal"
           dataSource={list}
           pagination={{
             showSizeChanger: true,
             total: total,
             showTotal(total, range) {
               return `${range[0]}-${range[1]} / ${total}`;
             },
             onChange(page, pageSize) {
               loadData(page, pageSize);
             },
           }}
           renderItem={(item) => {
             const apiLink = `/interface_info/${item.id}`;
             return (
               <List.Item actions={[<a key={item.id} href={apiLink}>æŸ¥çœ‹è¯¦æƒ…</a>]}>
                 <List.Item.Meta
                   title={<a href={apiLink}>{item.name}</a>}
                   description={item.description}
                 />
                 <div>{item.method}</div>
               </List.Item>
             );
           }}
         />
       </PageContainer>
     );
     ```

     ç‚¹å‡»é¡µé¢å³å¯æŸ¥çœ‹è¯¦æƒ…

     ![image-20240405163340336](å¼€å‘æ–‡æ¡£.assets/image-20240405163340336.png)

4.   **ç¼–å†™`InterfaceInfo/index.tsx`**

     è¿™é‡Œéœ€è¦æŸ¥çœ‹Ant Designä¸­çš„**Card** å’Œ **Descriptions** ç»„ä»¶ 

     å·²ç»umiä¸­åŠ¨æ€è·¯ç”±å¦‚ä½•è·å–è·¯å¾„ä¸­çš„id

     **ä»£ç å¦‚ä¸‹ï¼š**

     ```tsx
     import { PageContainer } from '@ant-design/pro-components';
     import { Badge, Card, Descriptions, message } from 'antd';
     import React, { useEffect, useState } from 'react';
     import { useParams } from 'react-router';
     import moment from "moment";
     import {getInterfaceInfoByIdUsingGet} from "@/services/linksauce-backend/interfaceInfoController";
     
     const InterfaceInfo: React.FC = () => {
       const [loading, setLoading] = useState(false);
       const [data, setData] = useState<API.InterfaceInfo>();
     
       const params = useParams();
     
       const loadData = async () => {
         if (!params.id) {
           message.error('æ— æ•°æ®ï¼Œè¯·é‡è¯•');
         }
         setLoading(true);
         try {
           const res = await getInterfaceInfoByIdUsingGet({
             id: Number(params.id),
           });
           setData(res?.data);
           setLoading(false);
         } catch (error: any) {
           setLoading(false);
           message.error('è¯·æ±‚å¤±è´¥,' + error.message);
         }
       };
     
       useEffect(() => {
         loadData();
       }, []);
     
       return (
         <PageContainer title={'æ¥å£è¯¦æƒ…'}>
           <Card loading={loading}>
             {data ? (
               <Descriptions title={data.name} column={2} layout="vertical" bordered={true}>
                 <Descriptions.Item label="æè¿°">{data.description}</Descriptions.Item>
                 <Descriptions.Item label="æ¥å£çŠ¶æ€">
                   {data.status === 0 ? (
                     <Badge text={'å…³é—­'} status={'default'} />
                   ) : (
                     <Badge text={'å¯ç”¨'} status={'processing'} />
                   )}
                 </Descriptions.Item>
                 <Descriptions.Item label="è¯·æ±‚åœ°å€">{data.url}</Descriptions.Item>
                 <Descriptions.Item label="è¯·æ±‚æ–¹æ³•">{data.method}</Descriptions.Item>
                 <Descriptions.Item label="è¯·æ±‚å¤´">{data.requestHeader}</Descriptions.Item>
                 <Descriptions.Item label="å“åº”å¤´">{data.responseHeader}</Descriptions.Item>
                 <Descriptions.Item label="åˆ›å»ºæ—¶é—´">{moment(data.createTime).format('yyyy-MM-DD HH:mm:ss')}</Descriptions.Item>
                 <Descriptions.Item label="æ›´æ–°æ—¶é—´">{moment(data.updateTime).format('yyyy-MM-DD HH:mm:ss')}</Descriptions.Item>
               </Descriptions>
             ) : (
               <>æ¥å£ä¸å­˜åœ¨</>
             )}
           </Card>
         </PageContainer>
       );
     };
     
     export default InterfaceInfo;
     ```

5.   **æ•ˆæœå¦‚ä¸‹**

     ç‚¹å‡»åè·³è½¬è¯¦æƒ…

     ![image-20240405163522953](å¼€å‘æ–‡æ¡£.assets/image-20240405163522953.png)



### 3ã€ç”³è¯·ç­¾å

---

**æ³¨å†Œç”¨æˆ·çš„æ—¶å€™å°±ç»™ä»–åˆ†é…ä¸€ä¸ªç­¾å**

å…ˆåœ¨**User**ç±»å’Œ`UserMapper.xml`ä¸­åŠ ä¸€ä¸‹**accessKey**ã€**secretKey**çš„å­—æ®µ

ä¿®æ”¹`User.java`,å¢åŠ å¦‚ä¸‹å­—æ®µ

```java
/**
 * ç­¾å accessKey
 */
private String accessKey;

/**
 * ç­¾å secretKey
 */
private String secretKey;
```

ä¿®æ”¹`UserMapper.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohh.project.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.ohh.project.model.entity.User">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="userName" column="userName" jdbcType="VARCHAR"/>
        <result property="userAccount" column="userAccount" jdbcType="VARCHAR"/>
        <result property="userAvatar" column="userAvatar" jdbcType="VARCHAR"/>
        <result property="gender" column="gender" jdbcType="TINYINT"/>
        <result property="userRole" column="userRole" jdbcType="VARCHAR"/>
        <result property="userPassword" column="userPassword" jdbcType="VARCHAR"/>
        <result property="accessKey" column="accessKey" jdbcType="VARCHAR"/>
        <result property="secretKey" column="secretKey" jdbcType="VARCHAR"/>
        <result property="createTime" column="createTime" jdbcType="TIMESTAMP"/>
        <result property="updateTime" column="updateTime" jdbcType="TIMESTAMP"/>
        <result property="isDelete" column="isDelete" jdbcType="TINYINT"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,userName,userAccount,
        userAvatar,gender,userRole,
        userPassword,accessKey,secretKey,createTime,updateTime,
        isDelete
    </sql>
</mapper>
```

æ›´æ–°æ³¨å†Œæ–¹æ³•`UserServiceImpl.java`

```java
@Override
public long userRegister(String userAccount, String userPassword, String checkPassword) {
    // 1. æ ¡éªŒ
    if (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
    }
    if (userAccount.length() < 4) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·è´¦å·è¿‡çŸ­");
    }
    if (userPassword.length() < 8 || checkPassword.length() < 8) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·å¯†ç è¿‡çŸ­");
    }
    // å¯†ç å’Œæ ¡éªŒå¯†ç ç›¸åŒ
    if (!userPassword.equals(checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
    }
    synchronized (userAccount.intern()) {
        // è´¦æˆ·ä¸èƒ½é‡å¤
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("userAccount", userAccount);
        long count = userMapper.selectCount(queryWrapper);
        if (count > 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é‡å¤");
        }
        // 2. åŠ å¯†
        String encryptPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
        // 3. åˆ†é… accessKey, secretKey
        String accessKey = DigestUtil.md5Hex(SALT + userAccount + RandomUtil.randomNumbers(4));
        String secretKey = DigestUtil.md5Hex(SALT + userAccount + RandomUtil.randomNumbers(8));
        // 4. æ’å…¥æ•°æ®
        User user = new User();
        user.setUserAccount(userAccount);
        user.setUserPassword(encryptPassword);
        user.setAccessKey(accessKey);
        user.setSecretKey(secretKey);
        boolean saveResult = this.save(user);
        if (!saveResult) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ³¨å†Œå¤±è´¥ï¼Œæ•°æ®åº“é”™è¯¯");
        }
        return user.getId();
    }
}
```



**åŠŸèƒ½æµ‹è¯•ï¼š**å‰å¾€http://localhost:7529/api/doc.htmlè¿›è¡Œæ³¨å†Œã€‚		

åˆ†é…æˆåŠŸ~

![image-20240405164016260](å¼€å‘æ–‡æ¡£.assets/image-20240405164016260.png)

